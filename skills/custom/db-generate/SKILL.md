---
name: db-generate
description: Use this skill to generate Java code (Entity, Mapper, Service, DTO, etc.) from database tables. Trigger when the user asks to "generate code for table X", "create entity for table Y", or "scaffold code from DB".
---

# Database Code Generator

This skill automates the generation of standard Java/MyBatis-Plus code artifacts from MySQL database tables.

## Usage

### 1. Generate Code for a Table

To generate code for a specific table (e.g., `t_scf_financing_order`):

```bash
python db_generate.py --table t_scf_financing_order --output-dir scf-loan-dal/src/main/java
```

### 2. Generate Multiple Tables (Not Supported via CLI)

Currently the script supports one table at a time. Run the command multiple times for multiple tables.

### 3. Generate Full Module (Default behavior)

The script generates Entity, Mapper, Service, ServiceImpl, DTO, and Convert classes by default.
Use `--generate-tests` to add unit tests.

```bash
python db_generate.py --table t_scf_financing_order --output-dir . --generate-tests
```

### 4. Validate Generated Code

```bash
python db_generate.py --table t_scf_financing_order --validate
```

## Configuration

Ensure `config.yml` is configured with correct DB credentials before running.

## Generated Artifacts

| Artifact | Package | Description |
|----------|---------|-------------|
| Entity | `.dal.entity` | JPA/MyBatis-Plus entity class |
| Mapper | `.dal.mapper` | MyBatis mapper interface |
| Service | `.biz.service` | Business logic interface |
| Impl | `.biz.service.impl` | Service implementation |
| DTO | `.common.dto` | Data Transfer Objects |
    - step: "运行代码生成工具"
      command: "python db_generate.py --table <table_name>"
    - step: "验证生成的代码"
      command: "python db_generate.py --table <table_name> --validate"
    - step: "生成单元测试"
      command: "python db_generate.py --table <table_name> --generate-tests"
    - step: "查看生成的代码"
      command: "检查输出目录中的生成文件"
    - step: "集成到项目中"
      command: "将生成的代码复制到对应模块"
  limitations:
    - "仅支持 MySQL 数据库"
    - "仅支持 MyBatis Plus 框架"
    - "复杂的表关系可能需要手动调整"
    - "使用 --ddl 参数时，DDL 文件必须按行定义列，每列定义占一行"
    - "DDL 文件中的注释必须使用单引号或双引号包围"
    - "DDL 文件中的索引定义必须单独占一行"
    - "DDL 文件中的表级配置（如 ENGINE、DEFAULT CHARSET 等）必须单独占一行"
  troubleshooting:
    - problem: "数据库连接失败"
      solution: "检查数据库连接参数和网络连接"
    - problem: "生成的代码编译错误"
      solution: "检查 Java 环境和依赖配置"
    - problem: "表结构不存在"
      solution: "确保指定的表在数据库中存在"
    - problem: "代码验证失败"
      solution: "根据验证错误信息修改代码"
  changelog:
    - version: "1.0.0"
      date: "2026-02-04"
      changes:
        - "初始版本，支持基本的代码生成功能"
        - "支持 MySQL 数据库表结构解析"
        - "生成实体类、Mapper、Service、DTO、ServiceImpl 代码"
        - "添加代码验证功能"
        - "添加单元测试生成功能"
  generated-files:
    header-policy: |
      所有由本技能自动生成的 Java 文件会在文件头部插入统一注释，包含：
      - 生成来源：Generated by skill: db-generate
      - 版本与时间：@version <技能版本>，@since <生成时间>
      - 修改告警：Do not modify directly；如需修改，请在注释中补充 @version、@since 以及详细变更说明，并优先通过技能再生
    environment:
      - name: SCF_SKILL_VERSION
        description: 覆盖注释中的技能版本号，默认 "1.0.0"
    rationale: |
      通过强制文件头标识，确保后续维护者清楚代码来源与再生产路径，减少手改导致的偏差；如确需手改，要求在注释进行充分记录与版本标注。
    files:
      - module: scf-loan-dal
        paths:
          - src/main/java/com/scf/loan/dal/entity/<Entity>.java
          - src/main/java/com/scf/loan/dal/mapper/<Mapper>.java
      - module: scf-loan-biz
        paths:
          - src/main/java/com/scf/loan/biz/service/<Service>.java
          - src/main/java/com/scf/loan/biz/service/impl/<ServiceImpl>.java
      - module: scf-loan-common
        paths:
          - src/main/java/com/scf/loan/common/dto/<DTO>.java
          - src/main/java/com/scf/loan/common/dto/<PageDTO>.java
