create table t_area_info
(
    AREA_CODE        varchar(10)            not null
        primary key,
    AREA_NAME        varchar(100)           null,
    AREA_PARENT_CODE varchar(30)            null,
    AREA_TYPE        varchar(20)            null,
    AREA_SPELL       varchar(20)            null,
    AREA_STS         varchar(20)            null,
    AREA_SHORTSPELL  varchar(10)            null,
    LAST_CHG_USR     varchar(20)            null,
    LAST_CHG_DT      varchar(20)            null,
    VERSION_STATE    varchar(50) default '' not null comment '版本控制'
)
    comment '省市区信息表';

create index IND_T_AREA_INFO_AREA_NAME
    on t_area_info (AREA_NAME);

create index IND_T_AREA_INFO_AREA_PARENT_CODE
    on t_area_info (AREA_PARENT_CODE);

create index IND_T_AREA_INFO_AREA_TYPE
    on t_area_info (AREA_TYPE);

create table t_bill
(
    id                bigint auto_increment comment '物理主键'
        primary key,
    bill_id           bigint                                     not null comment '账单号',
    order_id          bigint                                     not null comment '订单号',
    period int default 1 not null comment '期数',
    bill_type         tinyint(1)   default 1                     not null comment '帐单类型（1:普通帐单 2:担保帐单 3:提前清贷帐单 4:坏帐帐单 6:调整帐单 8:诉讼帐单 10:手续费账单）',
    repay_status      tinyint(1)   default 1                     not null comment '还款状态（1、未付款 2、部分付款 3、全额付款）',
    deduct_status     tinyint(1)   default 0                     not null comment '扣款状态(0:默认值 1:扣款失败) 与vbs一致',
    bill_date         datetime                                   not null comment '账单日',
    current           tinyint(1)   default 1                     not null comment '是否是当期（1-是，0-否）',
    clear_time        datetime     default '1970-01-01 00:00:00' not null comment '账单结清时间',
    due_date          datetime     default '1970-01-01 00:00:00' not null comment '账单逾期起始日',
    validity_period   datetime     default '1970-01-01 00:00:00' not null comment '账单有效期截止日',
    grace_period      int          default 3                     not null comment '宽限期',
    effect_status     tinyint(1)   default 2                     not null comment '生效状态（1-未激活、2-已激活、3-已失效）',
    canceled_time     datetime     default '1970-01-01 00:00:00' not null comment '注销时间',
    cancel_desc       varchar(200) default ''                    not null comment '注销原因',
    repay_type        tinyint(1)   default 1                     not null comment '还款类型（1:正常还款 2:提前还款 3:逾期还款）',
    shelve            tinyint(1)   default 2                     not null comment '是否挂起（1-是、2-否）',
    advance           tinyint(1)   default 2                     not null comment '是否代垫（1-是、2-否）',
    scene             tinyint(1)   default 2                     not null comment '场景（1-手工扣款，包括主动还款 2-系统跑批）',
    repay_date        varchar(32)  default ''                    not null comment '还款日',
    remake            varchar(255) default ''                    not null comment '备注',
    created_time      datetime                                   null,
    updated_time      datetime                                   null,
    coupon_use_notice int          default 0                     not null comment '已推送营销中心;0：未；1：已推送',
    constraint uidx_bill_id
        unique (bill_id)
)
    comment '账单表';

create index idx_bill_tyoe_status_shelve
    on t_bill (bill_type, repay_status, effect_status, shelve);

create index idx_order_id
    on t_bill (order_id);

create index idx_period
    on t_bill (period);

create table t_bill_advance_record
(
    id              bigint auto_increment comment '主键'
        primary key,
    record_id       bigint                                   not null comment '垫付记录ID',
    order_id        bigint                                   not null comment '订单ID',
    bill_id         bigint                                   not null comment '账单ID',
    bill_item_id    bigint         default 0                 not null comment '账单详情ID',
    subject_id      int            default 0                 not null comment '科目',
    advance_amount  decimal(24, 6) default 0.000000          not null comment '垫付金额',
    advance_time    datetime       default CURRENT_TIMESTAMP not null comment '垫付时间',
    received_amount decimal(24, 6) default 0.000000          not null comment '垫付时已还金额',
    source          int            default 1                 not null comment '代垫来源 1：跑批；2：资方推送接口；3：资方文件；4：手工添加',
    push_vas        tinyint(1)     default 1                 not null comment '推送VAS/SAP 1:推送；2：不推送',
    remake          varchar(255)   default ''                not null comment '备注',
    created_time    datetime                                 null,
    updated_time    datetime                                 null,
    constraint uidx_record_id
        unique (record_id)
)
    comment '代垫表';

create index idx_bill_id_subject
    on t_bill_advance_record (bill_id, subject_id);

create index idx_created_time
    on t_bill_advance_record (created_time);

create index idx_order_id
    on t_bill_advance_record (order_id);

create table t_bill_advance_source
(
    id              bigint auto_increment comment '主键'
        primary key,
    record_id       bigint                                   not null comment '垫付记录ID',
    order_id        bigint                                   not null comment '订单ID',
    bill_id         bigint                                   not null comment '账单ID',
    bill_item_id    bigint                                   not null comment '账单详情ID',
    subject_id      int            default 0                 not null comment '科目',
    advance_amount  decimal(24, 6) default 0.000000          not null comment '垫付金额',
    advance_time    datetime       default CURRENT_TIMESTAMP not null comment '垫付时间',
    received_amount decimal(24, 6) default 0.000000          not null comment '垫付时已还金额',
    push_vas        tinyint(1)     default 1                 not null comment '推送VAS/SAP 1:推送；2：不推送',
    remake          varchar(255)   default ''                not null comment '备注',
    created_time    datetime                                 null,
    updated_time    datetime                                 null,
    constraint uidx_record_id
        unique (record_id)
)
    comment '预代垫数据';

create index idx_created_time
    on t_bill_advance_source (created_time);

create index idx_order_id
    on t_bill_advance_source (order_id);

create table t_bill_balance
(
    id                         bigint auto_increment comment '标识ID'
        primary key,
    order_id                   bigint                          not null comment '业务号',
    capital_project_code       varchar(32)    default ''       not null comment '资金项目编码',
    capital_project_version_no varchar(60)    default ''       not null comment '资金项目版本号',
    loan_capital               decimal(24, 6) default 0.000000 not null comment '放款本金',
    repay_capital              decimal(24, 6) default 0.000000 not null comment '还款总额',
    compensatory_capital       decimal(24, 6) default 0.000000 not null comment '代偿总额',
    balance_capital            decimal(24, 6) default 0.000000 not null comment '对资在贷余额;对资在贷余额=放款本金-还款总额-代偿总额，且永远大于等于0',
    last_statis_date           datetime                        not null comment '最新统计日期',
    business_date              datetime                        not null comment '最后业务日期',
    capital_clear_state        int            default 1        not null comment '资方结清状态;0：偿还中；1：已结清（对资在贷余额为0）',
    created_time               datetime                        null,
    updated_time               datetime                        null
)
    comment '订单在贷余额';

create index idx_orde_id
    on t_bill_balance (order_id);

create index idx_union_01
    on t_bill_balance (capital_project_code, capital_project_version_no);

create table t_bill_balance_item
(
    id                   bigint auto_increment comment '标识ID'
        primary key,
    balance_item_id      bigint                                       not null comment '详情ID',
    order_id             bigint         default 0                     not null comment '业务号',
    begin_date           datetime                                     not null comment '开始日期(包含)',
    end_date             datetime       default '1970-01-01 00:00:00' not null comment '结束日期(不包含);暂无结束日期，默认1970-01-01',
    balance_capital      decimal(24, 6) default 0.000000              not null comment '在贷余额',
    loan_capital         decimal(24, 6) default 0.000000              not null comment '开始日期放款本金;放款时>0,其他为0',
    repay_capital        decimal(24, 6) default 0.000000              not null comment '开始日期还款本金;对资还款时大于0',
    compensatory_capital decimal(24, 6) default 0.000000              not null comment '开始日期代偿本金;对资代偿时大于0',
    created_time         datetime                                     null,
    updated_time         datetime                                     null,
    constraint uidx_balance_item_id
        unique (balance_item_id)
)
    comment '订单在贷余额明细';

create index idx_created_time
    on t_bill_balance_item (created_time);

create index idx_end_date
    on t_bill_balance_item (end_date);

create index idx_order_id
    on t_bill_balance_item (order_id);

create table t_bill_cancel_refund
(
    id            bigint auto_increment comment '主键'
        primary key,
    order_id      bigint                                       not null comment '订单号',
    cancel_time   datetime                                     not null comment '解约时间',
    refund_amount decimal(24, 6) default 0.000000              null comment '实退金额',
    pay_date      datetime       default '1970-01-01 00:00:00' null comment '付款时间',
    peceived_date datetime       default '1970-01-01 00:00:00' null comment '到账时间',
    pay_type      int            default 0                     null comment '到款方式;0、未扣款；1、银行扣款；2、转账；',
    cancel_type   int            default 2                     not null comment '解约类型;1:贷前解约；2：贷后解约',
    order_status  varchar(32)    default 'loaned'              not null comment '解约前状态;引用t_order_credit表中order_status',
    created_time  datetime       default CURRENT_TIMESTAMP     not null comment '创建时间',
    updated_time  datetime       default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '解约退款信息表';

create index idx_order_id
    on t_bill_cancel_refund (order_id);

create table t_bill_capital_reconciliation
(
    id               bigint auto_increment comment '主键'
        primary key,
    transaction_id   bigint                          not null comment '交易号',
    order_id         bigint                          not null comment '订单号',
    loan_receipt_no  varchar(60)    default ''       not null comment '借款借据号',
    bill_id          bigint         default -1       not null comment '账单ID;转担保存 -1',
    merchant_no      varchar(32)    default ''       not null comment '商户号',
    transaction_no   varchar(60)    default ''       not null comment '交易流水号',
    period int default 0 not null comment '还款期数',
    amount           decimal(24, 6) default 0.000000 not null comment '总金额',
    business_type    int            default 0        not null comment '业务类型;0：未设置；1：正常还款；2：提前还款；3：提前清贷；4：代垫还款；5：代偿（转担保）还款',
    data_source      int            default 1        not null comment '数据来源;1：资方；2：vbs',
    transaction_type int            default 0        not null comment '交易方式;0：未设置；1：扣款；2：主动还款；3：线下存对公',
    transaction_time datetime                        not null comment '交易时间',
    remark           varchar(255)   default ''       not null comment '备注',
    created_time     datetime                        null,
    updated_time     datetime                        null,
    association_id   bigint         default -1       not null comment '1、填账表id;2、代垫表id;3、债转表id;'
)
    comment '资方账务数据';

create index idx_created_time
    on t_bill_capital_reconciliation (created_time);

create index idx_order_id
    on t_bill_capital_reconciliation (order_id);

create index idx_transaction_id
    on t_bill_capital_reconciliation (transaction_id);

create table t_bill_capital_reconciliation_detailed
(
    id                 bigint auto_increment comment '主键'
        primary key,
    detailed_id        bigint                          not null comment '明细ID',
    transaction_id     bigint                          not null comment '交易号',
    bill_item_id       bigint         default 0        not null comment '账单详情ID',
    capital_subject    varchar(32)    default ''       not null comment '资方科目枚举',
    subject            int            default 0        not null comment 'vos科目枚举',
    receivable_amount  decimal(24, 6) default 0.000000 not null comment '账单应收金额',
    transaction_amount decimal(24, 6) default 0.000000 not null comment '交易金额',
    created_time       datetime                        null,
    updated_time       datetime                        null,
    constraint uidx_detailed_id
        unique (detailed_id)
)
    comment '资方账务明细数据';

create index idx_created_time
    on t_bill_capital_reconciliation_detailed (created_time);

create index idx_transaction_id
    on t_bill_capital_reconciliation_detailed (transaction_id);

create table t_bill_cash
(
    id                         bigint auto_increment comment '主键'
        primary key,
    cash_id                    bigint                                 not null comment '收现id',
    apply_id                   bigint                                 not null comment '收现、减免申请ID',
    offline_repayment_id       bigint                                 not null comment '线下还款表关联ID',
    order_id                   bigint       default 0                 not null comment '订单号',
    vbs_bid                    bigint       default 0                 not null comment 'VBS业务号',
    business_source            varchar(64)                            not null comment '订单所属（eg：南区上海等）',
    department                 varchar(64)                            not null comment '部门（总部、维仕金服、客维、电催）',
    process_type               int                                    not null comment '处理类型;1:收现；2：收现冲销',
    cashier_serial_number_type int          default 0                 not null comment '流水类型;（1-首次填账；2-非首次填账）',
    cashier_company            varchar(255) default ''                not null comment '收款公司',
    cashier_account_number     varchar(64)  default ''                not null comment '收款账号',
    cashier_opening_bank       varchar(64)  default ''                not null comment '收款账号银行及支行',
    process_system             int          default 0                 not null comment '处理业务系统;0：待定；1：VOS；2：VBS；',
    revocation_cash_id         bigint       default 0                 not null comment '被冲销收现id',
    created_time               datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time               datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uidx_cash_id
        unique (cash_id)
)
    comment '收现记录';

create index idx_apply_id
    on t_bill_cash (apply_id);

create index idx_created_time
    on t_bill_cash (created_time);

create index idx_offline_repayment_id
    on t_bill_cash (offline_repayment_id);

create index idx_order_vbs_id
    on t_bill_cash (order_id, vbs_bid);

create table t_bill_cash_reduction
(
    id                         bigint auto_increment comment '主键'
        primary key,
    apply_id                   bigint                                   not null comment '申请ID',
    order_id                   bigint         default 0                 not null comment '订单号',
    vbs_bid                    bigint         default 0                 not null comment 'VBS业务号',
    request_id                 varchar(64)                              not null comment '申请批次号',
    detail_id                  bigint                                   not null comment '明细号',
    payment_serial_number      varchar(64)    default ''                not null comment '支付流水号',
    repayment_source           varchar(32)    default 'notSet'          not null comment '填帐来源;app-KAKADAI：卡卡贷；app-DOUDOUQIAN：豆豆钱；cost-control:费控系统;finance-files:财务提供文件',
    operate_type               int            default 0                 not null comment '业务类型，1-收现；2-减免；3-收现减免',
    cashier_serial_number_type int            default 0                 not null comment '流水类型;（1-首次填账；2-非首次填账）',
    cash_amount                decimal(24, 6) default 0.000000          not null comment '收现申请金额',
    reduction_amount           decimal(24, 6) default 0.000000          not null comment '减免申请金额',
    process_type               int            default 0                 not null comment '处理类型;1:收现；2：收现冲销',
    filling_status             int            default 1                 not null comment '填帐状态;1：待填帐；2：填帐中；3：成功；4：失败',
    result_desc                varchar(255)   default ''                not null comment '填帐结果信息',
    remark                     varchar(255)   default ''                not null comment '备注',
    process_system             int            default 0                 not null comment '处理业务系统;0：待定；1：VOS；2：VBS；',
    callback_status            int            default 1                 not null comment '回调状态;1：未回调；2：回调成功；3：回调失败',
    created_time               datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time               datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uidx_apply_id
        unique (apply_id)
)
    comment '收现、减免记录';

create index idx_created_time
    on t_bill_cash_reduction (created_time);

create index idx_detail_id
    on t_bill_cash_reduction (detail_id);

create index idx_order_vbs_id
    on t_bill_cash_reduction (order_id, vbs_bid);

create index idx_payment_serial_number
    on t_bill_cash_reduction (payment_serial_number);

create index idx_request_id_type_source
    on t_bill_cash_reduction (request_id, process_type, repayment_source);

create table t_bill_channel_reconciliation
(
    id                       bigint auto_increment comment '主键'
        primary key,
    detail_id                bigint                                       not null comment '详情ID',
    order_id                 bigint         default 0                     null comment '订单号',
    channel_code             varchar(32)    default ''                    not null comment '扣款渠道编码',
    merchant_no              varchar(32)    default ''                    not null comment '商户号',
    type                     varchar(32)    default ''                    not null comment '类型 loan放款 repay还款',
    mode                     varchar(32)    default ''                    null comment '方式 微信 支付宝 扣款',
    transaction_no           varchar(60)    default ''                    not null comment '扣款渠道交易流水号',
    instruction_id           bigint         default 0                     null comment '对应还款子指令号',
    secondary_channel_code   varchar(32)    default ''                    not null comment '级次扣款渠道',
    secondary_transaction_no varchar(32)    default ''                    not null comment '级次扣款渠道交易流水号',
    apply_transaction_time   datetime       default '1970-01-01 00:00:00' not null comment '申请交易时间',
    amount                   decimal(24, 6) default 0.000000              not null comment '交易金额',
    transaction_success_time datetime       default '1970-01-01 00:00:00' not null comment '交易成功时间',
    transaction_status       int            default 1                     not null comment '状态;1成功  0失败',
    deduct_result            varchar(32)    default ''                    not null comment '扣款渠道结果',
    result_desc              varchar(90)    default ''                    not null comment '结果说明备注',
    to_account               varchar(32)    default ''                    null comment '到款商户',
    account_merchant_id      bigint         default 0                     null comment '账户&商户号绑定关系ID',
    fee                      decimal(24, 6) default 0.000000              not null comment '手续费',
    created_time             datetime                                     null,
    updated_time             datetime                                     null,
    push_vas                 int            default 1                     not null comment '推送vas类型：0：不推送；1:推送；',
    subject_ids              varchar(100)   default ''                    not null comment '科目号,多个以,分隔',
    constraint uidx_detail_id
        unique (detail_id)
)
    comment '通道资金流信息';

create index idx_created_time
    on t_bill_channel_reconciliation (created_time);

create index idx_order_id
    on t_bill_channel_reconciliation (order_id);

create table t_bill_creditor_transfer
(
    id                       bigint auto_increment comment '主键'
        primary key,
    creditor_transfer_id     bigint                                   not null comment '债转号',
    order_id                 bigint                                   null comment '订单号',
    repay_instruction_no     varchar(64)    default ''                not null comment '转担保号',
    surplus_principal        decimal(24, 6) default 0.000000          not null comment '剩余本金',
    surplus_interest         decimal(24, 6) default 0.000000          not null comment '剩余利息',
    due_principal            decimal(24, 6) default 0.000000          not null comment '欠费本金',
    due_interest             decimal(24, 6) default 0.000000          not null comment '欠费利息',
    due_penalty              decimal(24, 6) default 0.000000          not null comment '欠费罚息',
    advance_principal        decimal(24, 6) default 0.000000          not null comment '代垫本金',
    advance_interest         decimal(24, 6) default 0.000000          not null comment '代垫利息',
    advance_penalty          decimal(24, 6) default 0.000000          not null comment '代垫罚息',
    surplus_premium          decimal(24, 6) default 0.000000          not null comment '剩余保险费（未出）',
    due_premium              decimal(24, 6) default 0.000000          not null comment '保险费（已出未还）',
    creditor_transfer_time   datetime       default CURRENT_TIMESTAMP not null comment '债权转让时间',
    received_month           varchar(32)    default ''                not null comment '收款月份',
    sell_account_no          varchar(32)    default ''                not null comment '债转账户编码',
    transfer_account_no      varchar(32)    default ''                not null comment '承接债转账户编码',
    transfer_type            int            default 0                 not null comment '类型（1:普通债转; 2:外贸特殊债券转让; 3:包外债转; 4:原装分配; 5:质保债转; 6:特殊切回我司扣标记; 7:转担保; 8:转担保后债转; 10:债转给外部律所;）',
    sell_fund_source         varchar(32)    default ''                not null comment '转让资金包编号',
    sell_fund_expire_date    varchar(32)    default ''                not null comment '资金包提前到期日',
    transfer_fund_source     varchar(32)    default ''                not null comment '受让资金包编号',
    transfer_amount          decimal(24, 6) default 0.000000          not null comment '债转金额',
    transfer_discount_amount decimal(24, 6) default 0.000000          not null comment '债转折后金额',
    remark                   varchar(60)    default ''                not null comment '描述',
    credit_report_status     tinyint(1)     default 0                 not null comment '推送征信标识位 0:初始化(待定) 1:不推送 2:须推送',
    push_credit_report_time  datetime                                 null comment '推送征信状态更新时间',
    transfer_reason          tinyint(1)     default 1                 not null comment '债转原因: 1-客户原因 2-非客原因',
    created_time             datetime                                 null,
    updated_time             datetime                                 null,
    constraint uidx_creditor_transfer_id
        unique (creditor_transfer_id)
)
    comment '债转详情表';

create index idx_created_time
    on t_bill_creditor_transfer (created_time);

create index idx_creditor_transfer_time
    on t_bill_creditor_transfer (creditor_transfer_time);

create index idx_order_id
    on t_bill_creditor_transfer (order_id);

create table t_bill_guarantee
(
    id                        bigint         not null comment '主键'
        primary key,
    repay_instruction_item_no bigint         not null comment '还款子指令号',
    repay_instruction_no      bigint         not null comment '还款指令号',
    to_account                int            not null comment '到款商户',
    channel_code              varchar(32)    not null comment '通道编码',
    status                    tinyint(1)     not null comment '还款状态（1-处理中、2-成功、3-失败、4-异常）',
    reply_time                datetime       not null comment '还款回盘时间',
    remark                    varchar(60)    not null comment '还款描述',
    amount                    decimal(24, 6) not null comment '扣款科目总额',
    bill_item_id_list         varchar(225)   not null comment '扣款科目列表',
    create_time               datetime       not null comment '创建时间',
    update_time               datetime       not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '转担保详情表';

create table t_bill_item
(
    id                     bigint auto_increment comment '主键'
        primary key,
    bill_item_id           bigint                                       not null comment '账单科目号',
    bill_id                bigint                                       not null comment '账单号',
    subject_type           int            default 0                     not null comment '科目类型（0:默认,无类型 1:基础科目 2:逾期科目 3:提前清贷科目 4:手续费科目(保证金等) 5:诉讼科目）',
    subject_id             int                                          not null comment '科目号(1-本金 2-利息 3-罚息...)',
    receivable_amount      decimal(24, 6) default 0.000000              not null comment '应收金额',
    receipts_amount        decimal(24, 6) default 0.000000              not null comment '实收金额',
    due_amount             decimal(24, 6) default 0.000000              not null comment '逾期金额',
    clear_time             datetime       default '1970-01-01 00:00:00' not null comment '结清时间',
    next_calc_penalty_date datetime       default '1970-01-01 00:00:00' not null comment '下一次计算罚息日期',
    created_time           datetime                                     null,
    updated_time           datetime                                     null,
    constraint uidx_bill_item_id
        unique (bill_item_id)
)
    comment '账单科目表';

create index idx_bill_id
    on t_bill_item (bill_id);

create index idx_clear_time
    on t_bill_item (clear_time);

create table t_bill_letter
(
    id              bigint auto_increment comment '主键'
        primary key,
    order_id        bigint                                 not null comment '订单号',
    letter_name     varchar(256) default ''                not null comment '函件名称',
    bill_month      varchar(20)  default ''                not null comment '担保月',
    letter_type     int          default 0                 not null comment '函件类型',
    stamp_status    int          default 0                 not null comment '盖章状态;0-未盖章 1-已盖章 2-不需要盖章',
    before_stamp_id varchar(50)  default ''                not null comment '盖章前ECMID',
    after_stamp_id  varchar(50)  default ''                not null comment '盖章后ECMID',
    letter_state    int          default 0                 not null comment '阶段状态;0：待处理；1：成功；2：失败',
    remark          varchar(80)  default ''                not null comment '备注',
    send_state      int          default 0                 not null comment '发送状态;0：未发送；1：已发送',
    created_time    datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time    datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '函件表';

create index idx_created_time
    on t_bill_letter (created_time);

create index idx_order_id_bill_month
    on t_bill_letter (order_id, bill_month);

create table t_bill_letter_record
(
    id              bigint auto_increment comment '主键'
        primary key,
    order_id        bigint                                 not null comment '订单号',
    letter_name     varchar(256) default ''                not null comment '函件名称',
    letter_type     int          default 0                 not null comment '函件类型',
    before_stamp_id varchar(50)  default ''                not null comment '盖章前ECMID',
    after_stamp_id  varchar(50)  default ''                not null comment '盖章后ECMID',
    issue_type      int          default 0                 not null comment '开具状态 0-开具中(已生成，盖章中) 1-已开具(已生成，已盖章) 2-不可开具(已生成，我司无法盖章走线下)',
    remark          varchar(80)  default ''                not null comment '备注',
    issue_time      datetime     default CURRENT_TIMESTAMP not null comment '开具时间',
    enable_flag     int          default 1                 not null comment '启用状态;0：禁用；1：启用',
    created_time    datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time    datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '函件申请信息表';

create index idx_created_time
    on t_bill_letter_record (created_time);

create index idx_order_id
    on t_bill_letter_record (order_id);

create table t_bill_offline_repayment
(
    id                     bigint auto_increment comment '主键'
        primary key,
    repayment_id           bigint                                       not null comment '还款申请ID',
    apply_secondary_no     varchar(60)    default ''                    not null comment '申请流水号',
    order_id               bigint                                       not null comment '订单号',
    vbs_bid                bigint         default 0                     not null comment 'vbs订单号',
    apply_periods          varchar(32)    default ''                    not null comment '申请还款期次;下单期次，多个期次用英文逗号隔开，提前清贷期次为-1',
    total_actual_money     decimal(24, 6) default 0.000000              not null comment '支付总金额',
    apply_repayment_amount decimal(24, 6) default 0.000000              not null comment '本次申请还款金额',
    merchant_no            varchar(32)    default ''                    not null comment '收款商户号或收款卡号',
    payment_channel_code   varchar(32)    default ''                    not null comment '支付渠道;bank:银行转账;weixin:微信支付；BaofooTransfer：宝付下单存对公',
    user_name              varchar(32)    default ''                    not null comment '用户姓名',
    user_bank_card_no      varchar(32)    default ''                    not null comment '用户银行卡号',
    user_idenNo            varchar(32)    default ''                    not null comment '用户身份证',
    user_mobile            varchar(32)    default ''                    not null comment '用户手机号',
    user_bank_key          varchar(32)    default ''                    not null comment '用户银行枚举',
    user_opening_branch    varchar(90)    default ''                    not null comment '用户开户行',
    payment_serial_number  varchar(60)    default ''                    not null comment '支付流水号',
    payment_time           datetime       default '1970-01-01 00:00:00' not null comment '支付时间',
    payment_remark         varchar(255)   default ''                    not null comment '支付备注',
    repayment_source       varchar(32)    default ''                    not null comment '填帐来源;app-KAKADAI：卡卡贷；app-DOUDOUQIAN：豆豆钱；cost-control:费控系统;finance-files:财务提供文件',
    actual_fill_money      decimal(24, 6) default 0.000000              not null comment '实际填帐金额',
    over_money             decimal(24, 6) default 0.000000              not null comment '溢余金额',
    filling_status         int            default 1                     not null comment '处理状态  0：默认值；1：待处理；2：处理中；3：成功；4：失败；5：异常；',
    filling_remark         varchar(90)    default ''                    not null comment '填帐备注',
    applicant              varchar(32)    default ''                    not null comment '申请人',
    created_time           datetime                                     null,
    updated_time           datetime                                     null,
    freezing_code          varchar(100)   default ''                    not null comment '冻结码',
    vbs_serial_number      varchar(200)                                 null,
    cashier_company_code   varchar(32)    default ''                    not null comment '收款公司编码（例：800401）',
    process_system         int            default 0                     not null comment '处理业务系统;0：待定；1：VOS；2：VBS；',
    constraint uidx_repayment_id
        unique (repayment_id)
)
    comment '线下还款表';

create index idx_apply_secondary_no
    on t_bill_offline_repayment (apply_secondary_no);

create index idx_created_time
    on t_bill_offline_repayment (created_time);

create index idx_order_id
    on t_bill_offline_repayment (order_id);

create index idx_vbs_serial_number
    on t_bill_offline_repayment (vbs_serial_number);

create table t_bill_pay_capital
(
    id                   bigint auto_increment comment '主键'
        primary key,
    pay_id               bigint                                       not null comment '支付ID',
    batch_no             varchar(64)                                  not null comment '批次号',
    payer_merchant_no    varchar(64)                                  not null comment '付款商户号',
    payer_account_code   varchar(64)    default ''                    not null comment '付款账号',
    payee_bank           varchar(64)    default ''                    not null comment '收款对应银行key;(对公必传，对应编码找支付平台技术人员提供)',
    payee_account_name   varchar(64)    default ''                    not null comment '收款账号名称',
    payee_iden_no        varchar(64)    default ''                    not null comment '收款身份证号（对公非必填）',
    payee_mobile         varchar(32)    default ''                    not null comment '收款手机号（对公非必填）',
    payee_bank_card      varchar(32)                                  not null comment '收款银行卡号',
    payee_province       varchar(32)                                  not null comment '收款账号开户行所在省',
    payee_city           varchar(32)                                  not null comment '收款账号开户行所在市',
    payee_bra_bank_name  varchar(255)                                 not null comment '收款账号开户支行名称',
    capital_project_code varchar(32)                                  not null comment '资方编码',
    remark               varchar(255)   default ''                    not null comment '备注',
    channel_code         varchar(32)                                  not null comment '通道编码',
    sub_channel_code     varchar(32)    default ''                    not null comment '子通道编码',
    third_channel_code   varchar(32)    default ''                    not null comment '三级通道',
    total_amount         decimal(24, 6)                               not null comment '记录明细金额',
    pay_amount           decimal(24, 6) default 0.000000              not null comment '支付金额',
    send_time            datetime       default '1970-01-01 00:00:00' not null comment '发送时间',
    pay_serial_number    varchar(64)    default ''                    not null comment '支付流水号(支付给的)',
    pay_type             int            default 1                     not null comment '代付类型（1.存对公，2.代偿)',
    pay_model            int            default 1                     not null comment '支付模式：1-代付、2-代扣',
    pay_status           int            default 1                     not null comment '支付状态;1：待支付；2：处理中；3：成功；4：失败；5：错误',
    result_desc          varchar(255)   default ''                    not null comment '支付结果信息',
    pay_time             datetime       default '1970-01-01 00:00:00' not null comment '支付时间',
    created_time         datetime       default CURRENT_TIMESTAMP     not null comment '创建时间',
    updated_time         datetime       default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uidx_pay_id
        unique (pay_id)
)
    comment '支付到资方信息';

create index idx_batch_no
    on t_bill_pay_capital (batch_no);

create index idx_created_time
    on t_bill_pay_capital (created_time);

create index idx_payer_merchant_no
    on t_bill_pay_capital (payer_merchant_no);

create index idx_send_time
    on t_bill_pay_capital (send_time);

create table t_bill_pay_capital_details
(
    id             bigint auto_increment comment '主键'
        primary key,
    pay_details_id bigint                                   not null comment '支付详情id',
    pay_id         bigint                                   not null comment '支付ID',
    batch_no       varchar(64)                              not null comment '批次号',
    unpaid_id      bigint                                   not null comment '待支付Id',
    amount         decimal(24, 6) default 0.000000          not null comment '金额',
    created_time   datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time   datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uidx_pay_details_id
        unique (pay_details_id)
)
    comment '支付到资方信息详情';

create index idx_batch_no
    on t_bill_pay_capital_details (batch_no);

create index idx_created_time
    on t_bill_pay_capital_details (created_time);

create index idx_pay_id
    on t_bill_pay_capital_details (pay_id);

create index idx_unpaid_id
    on t_bill_pay_capital_details (unpaid_id);

create table t_bill_pay_instruction
(
    id                     bigint auto_increment
        primary key,
    app_serial_num         varchar(100)                                 not null comment '前端流水号',
    app_key                varchar(100)                                 not null comment '前端APP识别码',
    order_id               bigint                                       not null comment '业务编号',
    instruction_id         bigint                                       null comment '支付指令ID',
    external_refund_no     bigint                                       null comment 'VPC业务流水号',
    platform_key           varchar(100)                                 null comment '扣款通道编码',
    merchant_key           varchar(100)                                 null comment '商户号业务编码',
    amount                 decimal(24, 6) default 0.000000              not null comment '退费总金额(元)',
    bank_card              varchar(30)                                  null comment '银行卡',
    send_time              datetime                                     null comment '发送时间',
    platform_back_time     datetime                                     null comment '通道回盘时间',
    platform_refund_time   datetime                                     null comment '通道发起退款时间',
    refund_status          int                                          null comment '扣款状态(200：成功；500：失败; 100：未决)',
    description            varchar(100)                                 null comment '描述（对外输出）',
    remark                 varchar(500)                                 null,
    external_resp          varchar(100)                                 null comment '外部响应（vpc等）',
    external_refund_status varchar(100)                                 null comment 'vpc退款结果码',
    to_account_id          bigint                                       null comment '到款账户ID',
    orig_pay_type          smallint                                     null comment '原支付类型【或退款类型】（1:主动支付 2:代扣 7:任意退，代付）',
    refund_type            smallint                                     null comment '退款类型（1:前置费用 2:担保费扣失 3:还款失败费）',
    fill_status            tinyint(1)     default 2                     not null comment '填账状态（2：初始化;1：填账成功；0: 填账失败）',
    full_remark            varchar(100)                                 null comment '填账描述',
    platform_deduct_no     varchar(30)                                  null comment '通道（原始）扣款流水',
    customer_name          varchar(20)                                  null comment '客户姓名',
    bank_complete_time     datetime       default '1970-01-01 00:00:00' null comment '银行完成时间',
    created_time           datetime       default CURRENT_TIMESTAMP     null comment '创建时间',
    updated_time           datetime       default CURRENT_TIMESTAMP     null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '退款指令表';

create index idx_app
    on t_bill_pay_instruction (app_serial_num, app_key);

create index idx_created_time
    on t_bill_pay_instruction (created_time);

create index idx_external_refund_no
    on t_bill_pay_instruction (external_refund_no);

create index idx_instruction_id
    on t_bill_pay_instruction (instruction_id);

create table t_bill_push_tag
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id       bigint                                not null comment '订单号',
    source_data_id bigint      default 0                 not null comment '关联表ID',
    push_state     int         default 1                 not null comment '推送状态;1：待推送；2：已推送，待获取结果；3：成功；4：失败；5：异常（捕获到的异常，如驱动接口超时等）；',
    push_type      int         default 0                 not null comment '推送数据类型;0、未设置;1、t_bill_receipts 还款数据;2、t_bill_advance_source 预代垫数据;3、t_bill_advance_record 代垫数据;4、t_bill_creditor_transfer 转担保;5、t_bill 账单数据',
    push_target    int         default 0                 not null comment '推送目标;0、未设置;1、资方；2、VCS-催收；3、VCSS=客服（注销账单退款使用）；',
    remark         varchar(80) default ''                not null comment '备注',
    created_time   datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time   datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '数据推送记录表';

create index idx_created_time
    on t_bill_push_tag (created_time);

create index idx_order_id
    on t_bill_push_tag (order_id);

create index idx_source_data_id
    on t_bill_push_tag (source_data_id, push_state, push_type);

create table t_bill_receipts
(
    id                        bigint auto_increment comment '主键'
        primary key,
    received_id               bigint                          not null comment '账单实收号',
    bill_item_id              bigint                          not null comment '科目id',
    repay_instruction_item_id bigint         default 0        not null comment '还款指令号',
    amount                    decimal(24, 6) default 0.000000 not null comment '实收金额',
    receipts_type             int            default 0        not null comment '实收类型（1:线上还款 2:线下转账 3:减免 4：退回 5:减免资）',
    receipts_time             datetime                        null comment '收款时间',
    coupon_no                 varchar(64)    default ''       not null comment '优惠券编码',
    to_account                varchar(32)    default ''       not null comment '到款商户',
    channel_code              varchar(32)    default ''       not null comment '渠道编码',
    remake                    varchar(255)   default ''       not null comment '备注',
    created_time              datetime                        null,
    updated_time              datetime                        null,
    constraint uidx_received_id
        unique (received_id)
)
    comment '账单实收表';

create index idx_bill_item_id
    on t_bill_receipts (bill_item_id);

create index idx_created_time
    on t_bill_receipts (created_time);

create index idx_repay_instruction_item_id
    on t_bill_receipts (repay_instruction_item_id);

create table t_bill_reduction
(
    id                                 bigint auto_increment comment '主键'
        primary key,
    reduction_id                       bigint                                   null comment '减免指令id',
    apply_id                           bigint         default 0                 not null comment '收现、减免申请ID',
    apply_secondary_no                 varchar(64)                              null comment '申请流水号',
    order_id                           bigint         default 0                 not null comment '订单号',
    vbs_bid                            bigint         default 0                 not null comment 'VBS业务号',
    department                         varchar(64)    default ''                not null comment '部门',
    reduction_time                     datetime                                 null comment '申请减免时间',
    reduction_money                    decimal(24, 6) default 0.000000          not null comment '申请减免总金额',
    reduction_money_capital            decimal(24, 6) default 0.000000          not null comment '本金减免金额',
    reduction_money_not_capital        decimal(24, 6) default 0.000000          not null comment '非本金减免金额',
    remark                             varchar(255)   default ''                not null comment '申请减免备注',
    process_status                     int            default 1                 not null comment '处理状态;0：默认值；1：待处理；2：处理中；3：成功；4：失败；5：异常',
    result_desc                        varchar(255)   default ''                not null comment '填帐结果信息',
    actual_reduction_money             decimal(24, 6) default 0.000000          not null comment '实际减免金额',
    actual_reduction_money_capital     decimal(24, 6) default 0.000000          not null comment '实际减免资方金额',
    actual_reduction_money_not_capital decimal(24, 6) default 0.000000          not null comment '实际非本金减免金额',
    all_failed                         int            default -1                not null comment '减免全部失败（转账卡控标识）;-1：默认；0：本息，非本息减免全部成功;1：本息、非本息科目减免失败或部分成功',
    process_system                     int            default 0                 not null comment '处理业务系统;0：待定；1：VOS；2：VBS；',
    apply_source                       int            default 0                 not null comment '申请来源：0:默认 1-费控，2-客服 3-OA',
    created_time                       datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time                       datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint udix_reduction_id
        unique (reduction_id)
)
    comment '减免表';

create index idx_apply_id
    on t_bill_reduction (apply_id);

create index idx_apply_secondary_no
    on t_bill_reduction (apply_secondary_no);

create index idx_created_time
    on t_bill_reduction (created_time);

create index idx_order_id_vbs_bid
    on t_bill_reduction (order_id, vbs_bid);

create table t_bill_refund_accept_record
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    app_serial_num varchar(100)                       not null comment '前端流水号',
    app_key        varchar(100)                       not null comment '前端APP识别码',
    vbs_id         bigint                             not null comment '业务号',
    order_id       bigint                             not null comment '订单id',
    reason         varchar(500)                       null comment '理由',
    accept_code    varchar(100)                       null comment '受理状态码(200：受理成功；412=已退款，拒绝受理；503=当天无额度，拒绝受理）',
    created_time   datetime default CURRENT_TIMESTAMP null comment '创建时间',
    updated_time   datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '退款记录表';

create index idx_app
    on t_bill_refund_accept_record (app_serial_num, app_key);

create index idx_order_id
    on t_bill_refund_accept_record (order_id);

create index idx_vbs_id
    on t_bill_refund_accept_record (vbs_id);

create table t_bill_refund_accept_record_detail
(
    id               bigint unsigned auto_increment
        primary key,
    accept_record_id bigint                                   not null comment '请求记录主键（外键）',
    refund_id        bigint                                   not null comment '退款指令id',
    bill_item_id     bigint                                   null comment '数据ID',
    data_type        smallint                                 null comment '数据类型（3：科目id）',
    system_type      varchar(100)                             null comment '体系类型 1：体系内（营业内） 2：体系外（营业外）',
    amount           decimal(24, 6) default 0.000000          not null comment '科目退费金额(元)',
    created_time     datetime       default CURRENT_TIMESTAMP null comment '创建时间',
    updated_time     datetime       default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '退款受理明细表';

create index idx_accept_record_id
    on t_bill_refund_accept_record_detail (accept_record_id);

create index idx_bill_item_id
    on t_bill_refund_accept_record_detail (bill_item_id);

create index idx_refund_id
    on t_bill_refund_accept_record_detail (refund_id);

create table t_bill_repay_calculate
(
    id                 bigint auto_increment comment '主键'
        primary key,
    repay_calculate_no bigint                 not null comment '还款计划编码',
    order_id           bigint                 not null comment '订单号',
    period int not null comment '期数',
    bill_date          datetime               not null comment '账单日',
    repay_date         varchar(32) default '' not null comment '还款日 格式: yyyy-MM-dd',
    created_time       datetime               null,
    updated_time       datetime               null,
    constraint uidx_repay_calculate_no
        unique (repay_calculate_no)
)
    comment '还款计划表';

create index idx_order_id_period
    on t_bill_repay_calculate (order_id, period);

create table t_bill_repay_calculate_item
(
    id                      bigint auto_increment comment '主键'
        primary key,
    repay_calculate_item_no bigint                          not null,
    repay_calculate_no      bigint                          not null comment '账单号',
    subject_type            int            default 0        not null comment '科目类型（1:基础科目...）',
    subject_id              int                             not null comment '科目号(...)',
    receivable_amount       decimal(24, 6) default 0.000000 not null comment '应收金额',
    created_time            datetime                        null,
    updated_time            datetime                        null,
    constraint uidx_repay_calculate_item_no
        unique (repay_calculate_item_no)
)
    comment '还款计划科目表';

create index idx_repay_calculate_no
    on t_bill_repay_calculate_item (repay_calculate_no);

create table t_bill_repay_divide
(
    id                        bigint         not null comment '主键'
        primary key,
    order_no                  bigint         not null comment '订单id',
    repay_instruction_item_id bigint         not null comment '账单id',
    to_account                bigint         not null comment '到款商户',
    status                    tinyint(1)     not null comment '清分状态（1-处理中、2-成功、3-失败、4-异常）',
    remark                    varchar(225)   not null comment '清分描述',
    channel_code              varchar(64)    not null comment '扣款通道',
    amount                    decimal(24, 6) not null comment '清分科目总额',
    bill_item_id_list         varchar(225)   not null comment '清分科目列表',
    create_time               datetime       not null comment '创建时间',
    update_time               datetime       not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '还款清分表';

create table t_bill_repay_instruction
(
    id                         bigint auto_increment comment '主键'
        primary key,
    repay_instruction_id       bigint                                       not null comment '还款主指令号',
    freezing_code              varchar(100)   default ''                    not null comment '冻结码',
    group_no                   varchar(64)    default ''                    not null comment '扣款指令组号',
    order_id                   bigint                                       not null comment '订单号',
    bill_id                    bigint         default 0                     not null comment '账单号',
    repay_manual_id            bigint         default 0                     not null comment '手动扣款指令号',
    repay_card_id              bigint                                       not null comment '还款卡id',
    agreement_no               varchar(32)    default ''                    not null comment '协议号',
    to_account                 varchar(32)    default ''                    not null comment '到款商户',
    channel_code               varchar(32)    default ''                    not null comment '通道编码',
    sub_channel_code           varchar(32)    default ''                    not null comment '子通道编码',
    third_channel_code         varchar(32)    default ''                    not null comment '三级通道编码',
    stage                      int            default 1                     not null comment '还款阶段（1-试算、2-打包、3-申请、4-回盘）',
    status                     int            default 1                     not null comment '还款状态（1-初始化、2-处理中、3-成功、4-失败）',
    deduct_serial_number       varchar(64)    default ''                    not null comment '扣款流水号(支付给的)',
    reason_code                varchar(32)    default ''                    not null comment '原因码值（0000-成功 0001-余额不足 0002-我司异常 0003-通道失败）',
    channel_result_code        varchar(64)    default ''                    not null comment '通道返回编码',
    channel_result_desc        varchar(60)    default ''                    not null comment '通道结果描述',
    channel_repay_no           varchar(64)                                  null comment '通道扣款流水号',
    apply_time                 datetime       default CURRENT_TIMESTAMP     not null comment '还款申请时间',
    reply_time                 datetime       default '1970-01-01 00:00:00' not null comment '还款回盘时间',
    deduct_time                datetime       default '1970-01-01 00:00:00' not null comment '扣款成功时间',
    source                     int            default 3                     not null comment '发起场景枚举（1-账单日扣、2-宽限期内每日扣、3-宽限期外每日扣、4-宽限期内手工扣、5-宽限期外手工扣）',
    coupon_no                  varchar(64)    default ''                    not null comment '息费券编码',
    amount                     decimal(24, 6) default 0.000000              not null comment '扣款科目总额',
    bill_item_id_list          text                                         not null comment '扣款科目列表(逗号隔开)',
    created_time               datetime                                     null,
    updated_time               datetime                                     null,
    coupon_use_notice          int            default 0                     not null comment '已推送营销中心;0：未；1：已推送',
    instruction_type           int                                          not null comment '指令类型（1：普通扣款；2：分账扣款；3：优惠券；4：免息金;5:还款券；6：关怀抵扣券）',
    account_element_version_id varchar(64)    default ''                    not null comment '四要素版本号,取用户中心的versionId',
    over_month                 int            default 0                     not null comment '逾期月数,同order_tag表over_month',
    constraint uidx_repay_instruction_id
        unique (repay_instruction_id)
)
    comment '还款指令表';

create index idx_deduct_serial_number
    on t_bill_repay_instruction (deduct_serial_number);

create index idx_order_id_deduct_time
    on t_bill_repay_instruction (order_id, deduct_time);

create index idx_repay_manual_id
    on t_bill_repay_instruction (repay_manual_id);

create index idx_source_channe_account
    on t_bill_repay_instruction (source, channel_code, to_account);

create index idx_source_status
    on t_bill_repay_instruction (source, status);

create table t_bill_repay_instruction_item
(
    id                        bigint auto_increment comment '主键'
        primary key,
    repay_instruction_item_id bigint                          not null comment '还款子指令号',
    repay_instruction_id      bigint                          not null comment '还款指令号',
    to_account                varchar(32)    default ''       not null comment '到款商户',
    remark                    varchar(60)    default ''       not null comment '备注',
    amount                    decimal(24, 6) default 0.000000 not null comment '扣款科目总额',
    bill_item_id_list         varchar(225)   default ''       not null comment '扣款科目列表',
    created_time              datetime                        null,
    updated_time              datetime                        null,
    deduct_serial_number      varchar(64)    default ''       not null comment '非清分：扣款流水号；清分：扣款流水号_商户号',
    constraint uidx_repay_instruction_item_id
        unique (repay_instruction_item_id)
)
    comment '还款子指令表';

create index idx_repay_instruction_id
    on t_bill_repay_instruction_item (repay_instruction_id);

create table t_bill_repay_instruction_item_plugin
(
    id                        bigint auto_increment comment '主键'
        primary key,
    repay_instruction_item_id bigint                          not null comment '还款子指令号',
    repay_instruction_id      bigint                          not null comment '还款指令号',
    to_account                varchar(32)    default ''       not null comment '到款商户',
    remark                    varchar(60)    default ''       not null comment '备注',
    amount                    decimal(24, 6) default 0.000000 not null comment '扣款科目总额',
    bill_item_id_list         varchar(225)   default ''       not null comment '扣款科目列表',
    created_time              datetime                        null,
    updated_time              datetime                        null,
    deduct_serial_number      varchar(64)    default ''       not null comment '非清分：扣款流水号；清分：扣款流水号_商户号',
    constraint uidx_repay_instruction_item_id
        unique (repay_instruction_item_id)
)
    comment '还款子指令表解释器临时表';

create index idx_repay_instruction_id
    on t_bill_repay_instruction_item_plugin (repay_instruction_id);

create table t_bill_repay_instruction_plugin
(
    id                         bigint auto_increment comment '主键'
        primary key,
    repay_instruction_id       bigint                                       not null comment '还款主指令号',
    freezing_code              varchar(100)   default ''                    not null comment '冻结码',
    group_no                   varchar(64)    default ''                    not null comment '扣款指令组号',
    order_id                   bigint                                       not null comment '订单号',
    bill_id                    bigint         default 0                     not null comment '账单号',
    repay_manual_id            bigint         default 0                     not null comment '手动扣款指令号',
    repay_card_id              bigint                                       not null comment '还款卡id',
    agreement_no               varchar(32)    default ''                    not null comment '协议号',
    to_account                 varchar(32)    default ''                    not null comment '到款商户',
    channel_code               varchar(32)    default ''                    not null comment '通道编码',
    sub_channel_code           varchar(32)    default ''                    not null comment '子通道编码',
    third_channel_code         varchar(32)    default ''                    not null comment '三级通道编码',
    stage                      int            default 1                     not null comment '还款阶段（1-试算、2-打包、3-申请、4-回盘）',
    status                     int            default 1                     not null comment '还款状态（1-初始化、2-处理中、3-成功、4-失败）',
    deduct_serial_number       varchar(64)    default ''                    not null comment '扣款流水号(支付给的)',
    reason_code                varchar(32)    default ''                    not null comment '原因码值（0000-成功 0001-余额不足 0002-我司异常 0003-通道失败）',
    channel_result_code        varchar(64)    default ''                    not null comment '通道返回编码',
    channel_result_desc        varchar(255)   default ''                    not null comment '通道结果描述',
    channel_repay_no           varchar(64)                                  null comment '通道扣款流水号',
    apply_time                 datetime       default CURRENT_TIMESTAMP     not null comment '还款申请时间',
    reply_time                 datetime       default '1970-01-01 00:00:00' not null comment '还款回盘时间',
    deduct_time                datetime       default '1970-01-01 00:00:00' not null comment '扣款成功时间',
    source                     int            default 3                     not null comment '发起场景枚举（1-账单日扣、2-宽限期内每日扣、3-宽限期外每日扣、4-宽限期内手工扣、5-宽限期外手工扣）',
    coupon_no                  varchar(64)    default ''                    not null comment '息费券编码',
    amount                     decimal(24, 6) default 0.000000              not null comment '扣款科目总额',
    bill_item_id_list          text                                         not null comment '扣款科目列表(逗号隔开)',
    created_time               datetime                                     null,
    updated_time               datetime                                     null,
    coupon_use_notice          int            default 0                     not null comment '已推送营销中心;0：未；1：已推送',
    instruction_type           int                                          not null comment '指令类型（1：普通扣款；2：分账扣款；3：优惠券；4：免息金）',
    account_element_version_id varchar(64)    default ''                    not null comment '四要素版本号,取用户中心的versionId',
    over_month                 int            default 0                     not null comment '逾期月数,同order_tag表over_month',
    constraint uidx_repay_instruction_id
        unique (repay_instruction_id)
)
    comment '还款指令表解释器临时表';

create index idx_bill_id
    on t_bill_repay_instruction_plugin (bill_id);

create index idx_group_no
    on t_bill_repay_instruction_plugin (group_no);

create index idx_order_freezing_group
    on t_bill_repay_instruction_plugin (order_id, freezing_code, group_no);

create table t_bill_repay_instruction_temp
(
    id                        bigint auto_increment comment '主键'
        primary key,
    repay_instruction_temp_id bigint                  not null,
    repay_instruction_id      bigint                  not null comment '还款指令号',
    batch_no                  varchar(64)  default '' not null comment '批次号',
    group_no                  varchar(64)  default '' not null comment '扣款指令组号',
    priority                  int          default 1  not null comment '优先级(数字越大优先级越高)',
    reliant                   int          default 2  not null comment '是否有依赖（1-是、2-否）',
    remark                    varchar(255) default '' not null comment '扣款描述',
    created_time              datetime                null,
    updated_time              datetime                null
)
    comment '还款指令临时表';

create table t_bill_repay_instruction_temp_plugin
(
    id                        bigint auto_increment comment '主键'
        primary key,
    repay_instruction_temp_id bigint                  not null,
    repay_instruction_id      bigint                  not null comment '还款指令号',
    group_no                  varchar(64)             not null comment '扣款指令组号',
    priority                  int                     not null comment '优先级(数字越大优先级越高)',
    reliant                   int                     not null comment '是否有依赖（1-是、2-否）',
    remark                    varchar(255)            not null comment '扣款描述',
    created_time              datetime                null,
    updated_time              datetime                null,
    freezing_code             varchar(100) default '' not null comment '冻结码',
    constraint uidx_repay_instruction_temp_id
        unique (repay_instruction_temp_id)
)
    comment '还款指令临时表';

create index idx_group_no
    on t_bill_repay_instruction_temp_plugin (group_no);

create index idx_repay_instruction_id
    on t_bill_repay_instruction_temp_plugin (repay_instruction_id);

create table t_bill_repay_manual
(
    id                bigint auto_increment comment '主键'
        primary key,
    repay_manual_id   bigint                                   not null comment '手工扣款指令号',
    freezing_code     varchar(100)   default ''                not null comment '冻结码',
    order_id          bigint                                   not null comment '订单号',
    repay_apply_no    varchar(64)    default ''                not null comment '还款申请流水号（用于唯一性校验）',
    remark            varchar(225)   default ''                not null comment '还款描述',
    apply_time        datetime       default CURRENT_TIMESTAMP not null comment '还款申请时间',
    source            varchar(64)    default '1'               not null comment '扣款来源(notSet:未设置; app-KAKADAI:卡卡贷; app-DOUDOUQIAN:豆豆钱; vcs:催收; vcss:客户系统; cost-control:客户系统; finance-files:财务提供文件; other:其他;)',
    account_no        varchar(32)    default ''                not null comment '指定到款账号时必填（如:手工扣）',
    total_amount      decimal(24, 6) default 0.000000          not null comment '扣款科目总额',
    deduct_amount     decimal(24, 6) default 0.000000          not null comment '已发起扣款金额',
    balance           decimal(24, 6) default 0.000000          not null comment '发起手工扣款余额（扣款科目总额-已发起扣款金额）',
    step              int            default 1                 not null comment '步骤(1-待扣款；2-处理中；3-结束)',
    operation_user_id varchar(64)    default ''                not null comment '操作人ID',
    created_time      datetime                                 null,
    updated_time      datetime                                 null,
    state             varchar(20)    default 'pending'         not null comment '扣款状态 success:成功; failure:失败; pending:处理中;',
    success_amount    decimal(24, 6) default 0.000000          not null comment '已扣款金额',
    vbs_serial_number varchar(200)                             null,
    vbs_bid           bigint         default 0                 not null comment 'VBS业务号',
    process_system    int            default 0                 not null comment '处理业务系统;0：待定；1：VOS；2：VBS；',
    part_repayment    tinyint(1)     default 0                 not null comment '是否为部分还款 0:不是； 1:是',
    shelve            tinyint(1)     default 0                 not null comment '是否为清贷账单挂起 0:不是； 1:是',
    constraint uidx_repay_manual_id
        unique (repay_manual_id)
)
    comment '手工扣款表（含主动还款）';

create index idx_apply_time
    on t_bill_repay_manual (apply_time);

create index idx_order_id
    on t_bill_repay_manual (order_id);

create index idx_repay_apply_no
    on t_bill_repay_manual (repay_apply_no);

create index idx_vbs_serial_number
    on t_bill_repay_manual (vbs_serial_number);

create table t_bill_share
(
    id                        bigint auto_increment comment '标识ID'
        primary key,
    share_id                  bigint                                        not null comment '分润ID',
    order_id                  bigint          default 0                     not null comment '业务号',
    bill_id                   bigint          default -1                    not null comment '账单ID',
    bill_item_id              bigint          default -1                    not null comment '账单详情ID',
    received_id               bigint          default -1                    not null comment '填帐ID',
    suffer_share_subject      int             default 0                     not null comment '被分润科目',
    suffer_share_amount       decimal(24, 6)  default 0.000000              not null comment '被分润金额',
    suffer_share_org_code     varchar(32)     default ''                    not null comment '被分润机构编码',
    suffer_share_account_code varchar(32)     default ''                    not null comment '被分润到款账号',
    suffer_share_partner      varchar(32)     default ''                    not null comment '被分润方类型',
    share_rate                decimal(24, 10) default 0.0000000000          not null comment '分润比率',
    share_type                int             default 0                     not null comment '分润类型;0：未设置；1：实收分润；2：代垫分润；3：转担保分润/债转分润；5：放款分润；6：费用分润扣减；7：费用分润扣减；8：浮动分润；9：通道费分润；21：联贷方-实收分润；22：联贷方-代垫分润；23：联贷方-转担保分润/债转分润；25：联贷方-放款分润',
    share_model               int             default 0                     not null comment 'VAS 抽取数据模式;0：按create_time 1：按share_time',
    share_org_code            varchar(32)     default ''                    not null comment '分润机构编码',
    share_partner             varchar(32)     default ''                    not null comment '分润方类型',
    share_time                datetime                                      not null comment '分润时间',
    to_subject                int                                           not null comment '分润科目',
    share_amount              decimal(24, 6)  default 0.000000              not null comment '分润金额',
    direction                 int             default 1                     not null comment '方向（负金额使用反向）;1.正向、2.反向',
    trigger_time              datetime        default '1970-01-01 00:00:00' not null comment '业务触发时间',
    created_time              datetime                                      null,
    updated_time              datetime                                      null,
    application_number        varchar(32)     default ''                    null comment '授信申请号',
    constraint uidx_share_id
        unique (share_id)
)
    comment '分润详情';

create index idx_application_number
    on t_bill_share (application_number);

create index idx_order_bill_item_subject
    on t_bill_share (order_id, bill_id, bill_item_id, to_subject);

create index idx_received_id
    on t_bill_share (received_id);

create table t_bill_unpaid_to_capital
(
    id                   bigint auto_increment comment '主键'
        primary key,
    unpaid_id            bigint                                       not null comment '待支付Id',
    order_id             bigint                                       not null comment '订单号',
    bill_id              bigint                                       not null comment '账单号',
    bill_item_id         bigint                                       not null comment '账单详情',
    received_id          bigint         default 0                     not null comment '填帐id',
    amount               decimal(24, 6) default 0.000000              not null comment '金额',
    capital_project_code varchar(32)    default ''                    not null comment '资金项目编码',
    pay_status           int            default 1                     not null comment '支付状态;1：待支付；2：处理中；3：成功；4：失败',
    pay_type             int            default 1                     not null comment '支付类型：1-存对公、2-代偿、3-回购',
    pay_model            int            default 1                     not null comment '支付模式：1-代付、2-代扣',
    result_desc          varchar(255)   default ''                    not null comment '支付结果信息',
    pay_time             datetime       default '1970-01-01 00:00:00' not null comment '支付时间',
    created_time         datetime       default CURRENT_TIMESTAMP     not null comment '创建时间',
    updated_time         datetime       default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uidx_unpaid_id
        unique (unpaid_id)
)
    comment '待支付到资方信息';

create index idx_bill_id
    on t_bill_unpaid_to_capital (bill_id, bill_item_id, received_id);

create index idx_created_time
    on t_bill_unpaid_to_capital (created_time);

create index idx_order_id
    on t_bill_unpaid_to_capital (order_id);

create table t_business
(
    id                         bigint auto_increment comment '主键'
        primary key,
    order_id                   bigint                               not null comment '订单号',
    receipt_version            varchar(50)                          null comment '借款借据版本',
    period_kind                tinyint(1) default 1                 not null comment '贷款期限类型;1:month;2:day',
    relative_date              date                                 not null comment '相对账单日',
    agreed_clear_loan_time     datetime                             not null comment '自然结清日期',
    next_bill_date             datetime                             null comment '下一账单日',
    is_repayment               tinyint(1) default 1                 not null comment '是否偿还中;1代表是 0代表不是',
    business_status            tinyint(1)                           null comment '业务状态;1、正常 2、代偿 3、诉讼 5、回购 6、解约',
    compensatory_type          tinyint(1)                           null comment '代偿类型;0-未代偿、1-普通债转、2-外贸特殊债券转让、3-包外债转、4-原装分配、5-质保债转、6-特殊切回我司扣标记、7-转担保、8-转担保后债转',
    compensatory_date          datetime                             null comment '代偿日期',
    guarantee_num              varchar(50)                          null comment '担保批次',
    lawsuit_status             tinyint(1)                           null comment '诉讼执行状态;1、未诉讼 2、诉讼中 3、诉讼完成 4、申请执行 5、执行一次 6、执行二次',
    to_litigation_time         datetime                             null comment '转诉讼日期',
    lawsuit_code               varchar(50)                          null comment '判决案号（诉讼订单使用）',
    clear_state                tinyint(1)                           null comment '清贷状态;1、偿还中  2、满约清贷 3、提前清贷 4、坏帐清贷 5、提前清贷申请 6、坏账申请 7、提前清贷中',
    actual_clear_loan_time     datetime                             null comment '实际清贷时间',
    freezing_code              varchar(50)                          null comment '冻结码',
    over_month                 int                                  null comment '逾期月数',
    over_amount                decimal(18, 2)                       null comment '逾期欠费',
    dad_debt_stamp             tinyint(1)                           null comment '坏账标记',
    dad_debt_create_time       datetime                             null comment '坏账标记时间',
    distressed_asset_flag      tinyint(1)                           null comment '不良资产标记;1.不良资产',
    distressed_asset_remark    varchar(100)                         null comment '不良资产备注',
    distressed_asset_side_code varchar(20)                          null comment '不良资产受让方编码',
    create_time                datetime   default CURRENT_TIMESTAMP null comment '创建时间',
    update_time                datetime   default CURRENT_TIMESTAMP null comment '更新时间'
)
    comment '订单放款后扩展表';

create index idx_billdate
    on t_business (next_bill_date, relative_date, is_repayment);

create index idx_order_id
    on t_business (order_id);

create table t_common_region_info
(
    region_code  char(10)                            not null comment '行政区域编码（唯一）'
        primary key,
    region_name  varchar(20)                         not null comment '行政区域名称',
    created_time timestamp default CURRENT_TIMESTAMP not null comment '记录创建时间',
    updated_time timestamp default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '记录更新时间',
    active       tinyint                             not null comment '是否激活有效',
    desc_cn      varchar(50)                         null comment '说明（中文）'
)
    comment '【行政区域】枚举表';

create table t_common_zip_code_info
(
    zip_code_name varchar(20)                        not null
        primary key,
    zip_code      char(10)                           not null comment '全国邮编(市级别)',
    created_time  datetime default CURRENT_TIMESTAMP not null comment '记录创建时间',
    updated_time  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '记录更新时间',
    active        tinyint  default 1                 not null comment '是否激活有效',
    desc_cn       varchar(50)                        null comment '说明（中文）'
);

create table t_ddq_slt_account
(
    id                     bigint unsigned auto_increment comment '主键'
        primary key,
    customer_id            bigint unsigned                              not null comment '客户表id',
    credit_auth_id         bigint unsigned                              not null comment '额度表id',
    trans_status           int                                          not null comment '提现和还款的状态（-9:系统判定中,-5:待绑卡,-4:待签合同,-3:待补资料,-2提现申请复核中,-1提现申请失败,0:提现申请中;1:提现完成; 2:还款已提交;3:已逾期; 4:已还清;5:已解约;）',
    vbs_bid                int unsigned                                 null comment 'vbs订单编号',
    card_id                bigint unsigned                              not null comment '此订单提现绑定卡id',
    begin_date             datetime                                     null comment '贷款订单开始日期',
    end_date               datetime                                     null comment '贷款订单结束日期',
    loan_type              varchar(3)                                   not null comment '贷款类型标识（0：首贷；1：加贷；2：再贷）',
    vbs_fail_flag          varchar(2)     default '-1'                  null comment '电审同意提现调用vbs接口标记 -1-未异常 1-有异常',
    sub_trans_status       varchar(2)                                   null comment '账单日扣款子状态 0：已放款，1：扣款中，2：暂未扣到',
    money_lender           varchar(32)                                  null comment '放款方',
    credit_level           varchar(3)                                   null comment '此订单信用评级快照',
    prepact_no             varchar(40)                                  null comment '预审批id',
    contract_no            varchar(30)                                  null comment 'vbs贷款合同编号',
    created_date           datetime                                     not null comment '记录创建时间',
    updated_date           datetime                                     not null comment '记录更新时间',
    withdraw_use           tinyint        default 0                     not null comment '提现用途 1-家用电器 2-手机数码 3-旅游 4-装修 5-教育 6-婚庆 7-租房 8-家具家居 9-健康医疗 10-其他',
    clear_loan_time        datetime       default '1970-01-01 08:00:01' not null comment 'vbs订单结清时间',
    approved_amount        decimal(16, 2) default -1.00                 not null comment '提现时审批金额',
    money_lender_option    varchar(255)   default ''                    not null comment '备选放款方',
    do_jd_decision         tinyint(1)     default -1                    not null comment '是否要做加贷决策 1-是 0-否',
    customer_mark          varchar(100)   default ''                    not null comment '标签_客户类型',
    slt_cust_level         varchar(10)    default ''                    not null comment '订单客户评级',
    process_id             varchar(64)    default '-1'                  not null comment 'processId',
    n_appt_combrate_three  decimal(8, 6)  default 0.000000              not null comment '非指定资方3期综合费率',
    n_appt_combrate_six    decimal(8, 6)  default 0.000000              not null comment '非指定资方6期综合费率',
    n_appt_combrate_twelve decimal(8, 6)  default 0.000000              not null comment '非指定资方12期综合费率',
    appt_combrate_three    decimal(8, 6)  default 0.000000              not null comment '指定资方3期综合费率',
    appt_combrate_n_three  decimal(8, 6)  default 0.000000              not null comment '指定资方非3期综合费率',
    credit_record_id       bigint         default -1                    not null comment '额度记录表id',
    customer_mark_extra    varchar(100)   default ''                    not null comment '补充_客户类型: 优质正常客户，VIP客户，正常客户，66客户，333客户',
    ml_route_mode          varchar(2)     default '-1'                  not null comment '1-资方路由模式',
    sub_loan_type          varchar(6)     default '-1'                  not null comment '取现类型标识（首贷,加贷,再贷-A,再贷-B,）',
    sub_process_id         varchar(64)    default '-1'                  not null comment '取现processId',
    product_type           varchar(20)    default ''                    not null comment '产品种类',
    charge_fee             tinyint(1)     default 0                     not null comment '是否收取前置费用 0-收取 1-低息无费不收 2-电销减免不收 3-渠道不收',
    re_preaudit            tinyint(1)     default 0                     not null comment '重走预审批标记 0-不重走 1-后续判资方 2-重走',
    comb_rate              decimal(8, 6)  default 0.000000              not null comment '月综合费率',
    vbs_bid_created_time   datetime       default '1970-01-01 00:00:00' not null comment 'vbs_bid创建时间',
    user_coupon_no         varchar(64)    default ''                    not null comment '息费券编号',
    process_version        varchar(3)     default ''                    not null comment '流程版本',
    vos_order_id           bigint         default -1                    not null comment 'vos订单号'
)
    comment '提现订单信息表' charset = utf8;

create index idx_BEGIN_DATE
    on t_ddq_slt_account (begin_date);

create index idx_card_id
    on t_ddq_slt_account (card_id);

create index idx_clear_loan_time
    on t_ddq_slt_account (clear_loan_time);

create index idx_created_date
    on t_ddq_slt_account (created_date);

create index idx_credit_auth_id
    on t_ddq_slt_account (credit_auth_id);

create index idx_credit_record_id
    on t_ddq_slt_account (credit_record_id);

create index idx_customer_id
    on t_ddq_slt_account (customer_id);

create index idx_trans_status
    on t_ddq_slt_account (trans_status);

create index idx_updated_date
    on t_ddq_slt_account (updated_date);

create index idx_vbs_bid
    on t_ddq_slt_account (vbs_bid);

create index idx_vos_order_id
    on t_ddq_slt_account (vos_order_id);

create table t_driver_approval_info
(
    id              bigint auto_increment
        primary key,
    approval_result tinyint     default 1                 null comment '0:审核失败 1:审核成功 2.请求失败 3请求成功验证失败',
    risk_info_token varchar(64) default ''                not null comment '用户信息Token，用于金融机构查询隔离区数据',
    register_id     varchar(64) default ''                not null comment '注册id',
    create_time     datetime    default CURRENT_TIMESTAMP not null,
    update_time     datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP,
    is_deleted      tinyint(1)  default 0                 not null comment '是否删除: 0.否 1.是',
    channel_id      varchar(64)                           not null comment '渠道id'
)
    comment '资方信息审核表';

create index idx_result_create
    on t_driver_approval_info (approval_result, create_time);

create index idx_risk
    on t_driver_approval_info (risk_info_token);

create table t_finance_capital_reconciliation
(
    id                      bigint unsigned auto_increment comment 'primary key'
        primary key,
    fund_name               varchar(200)   default ''                not null comment '资方描述',
    guarantor               varchar(200)   default ''                not null comment '担保方',
    contract_number         varchar(40)    default ''                not null comment '合同号',
    order_id                bigint         default 0                 not null comment '订单号',
    bill_id                 bigint         default 0                 not null comment '账单号',
    bill_desc               varchar(50)    default ''                not null comment '账单描述',
    bill_date               varchar(20)    default ''                not null comment '账单日期',
    repay_date              varchar(20)    default ''                not null comment '还款日期',
    business_type           varchar(20)    default ''                not null comment '业务类型',
    repay_type              varchar(20)    default ''                not null comment '还款类型',
    total_period            int            default 0                 not null comment '总期数',
    current_period          int            default 0                 not null comment '还款期数',
    subject                 varchar(20)    default ''                not null comment '费项科目',
    capital_receival_date   varchar(20)    default ''                not null comment '资方入账日期',
    capital_receival_amount decimal(24, 6) default 0.000000          not null comment '资方入账金额',
    amount                  decimal(24, 6) default 0.000000          not null comment '金额',
    diff_amount             decimal(24, 6) default 0.000000          not null comment '差异金额',
    deduct_amount           decimal(24, 6) default 0.000000          not null comment '减免资金额',
    created_time            datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time            datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    capital_project_code    varchar(20)    default ''                not null comment 'capitalProjectCode',
    subject_id              int                                      not null comment '科目号(1-本金 2-利息 3-罚息...)',
    summarized_date         varchar(20)                              not null comment '汇总日期',
    vbs_bid                 bigint         default 0                 not null comment 'VBS业务号'
)
    comment '资方对账回盘财务表' charset = utf8mb4;

create index idx_repay_date
    on t_finance_capital_reconciliation (repay_date);

create index idx_updated_time
    on t_finance_capital_reconciliation (updated_time);

create table t_finance_collect_advance
(
    id                   bigint unsigned auto_increment comment 'primary key'
        primary key,
    fund_name            varchar(200)   default ''                not null comment '资方描述',
    guarantor            varchar(200)   default ''                not null comment '担保方',
    contract_number      varchar(40)    default ''                not null comment '合同号',
    order_id             bigint         default 0                 not null comment '订单号',
    bill_id              bigint         default 0                 not null comment '账单号',
    bill_desc            varchar(50)    default ''                not null comment '账单描述',
    bill_date            varchar(20)    default ''                not null comment '账单日期',
    repay_date           varchar(20)    default ''                not null comment '还款日期',
    business_type        varchar(20)    default ''                not null comment '业务类型',
    repay_type           varchar(20)    default ''                not null comment '还款类型',
    total_period         int            default 0                 not null comment '总期数',
    current_period       int            default 0                 not null comment '还款期数',
    subject              varchar(20)    default ''                not null comment '费项科目',
    amount               decimal(24, 6) default 0.000000          not null comment '金额',
    is_deduct            tinyint        default 0                 not null comment '是否减免资',
    created_time         datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    capital_project_code varchar(20)    default ''                not null comment 'capitalProjectCode',
    subject_id           int                                      not null comment '科目号(1-本金 2-利息 3-罚息...)',
    summarized_date      varchar(20)                              not null comment '汇总日期',
    vbs_bid              bigint         default 0                 not null comment 'VBS业务号'
)
    comment '代收代垫财务表' charset = utf8mb4;

create index idx_repay_date
    on t_finance_collect_advance (repay_date);

create index idx_updated_time
    on t_finance_collect_advance (updated_time);

create table t_guarantee_bill
(
    id               int            not null comment '主键'
        primary key,
    order_id         int            null comment '订单号',
    guarantee_date   datetime       null comment '转担保日期',
    res_capital      decimal(24, 6) null comment '未出本金',
    due_capital      decimal(24, 6) null comment '逾期本金',
    res_interest     decimal(24, 6) null comment '未出利息',
    due_interest     decimal(24, 6) null comment '逾期利息',
    due_penalty      decimal(24, 6) null comment '逾期罚息',
    due_other        decimal(24, 6) null comment '逾期其他费用',
    advance_capital  decimal(24, 6) null comment '代垫本金',
    advance_interest decimal(24, 6) null comment '代垫利息',
    advance_penalty  decimal(24, 6) null comment '代垫罚息',
    advance_other    decimal(24, 6) null comment '代垫其他费用',
    received_month   datetime       null comment '收款月份'
)
    comment '担保账单表';

create table t_invoice_config
(
    id                bigint unsigned auto_increment comment '主键'
        primary key,
    invoice_config_id varchar(20)  default ''                not null comment '配置id',
    revenue_code      varchar(20)  default ''                not null comment '收益方(开票方)编码',
    taxpayer_name     varchar(80)  default ''                not null comment '纳税人名称',
    taxpayer_no       varchar(20)  default ''                not null comment '纳税人税号',
    identity          varchar(80)  default ''                not null comment '(航信)身份id',
    goods_code        varchar(20)  default ''                not null comment '商品税收编号',
    goods_name        varchar(80)  default ''                not null comment '商品名称',
    tax_rate          varchar(20)  default ''                not null comment '税率',
    top_amount        varchar(20)  default ''                not null comment '最高金额',
    payee             varchar(20)  default ''                not null comment '受款人',
    checker           varchar(20)  default ''                not null comment '检验员',
    clerk             varchar(20)  default ''                not null comment '开票人',
    is_deleted        varchar(20)  default ''                not null comment '是否删除 0-未删 1-已删',
    created_time      datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time      datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    taxpayer_account  varchar(200) default ''                not null comment '纳税人银行开户行及账号',
    taxpayer_phone    varchar(200) default ''                not null comment '纳税人电话',
    taxpayer_address  varchar(200) default ''                not null comment '纳税人地址',
    constraint in_revenue_code
        unique (revenue_code)
)
    comment '电子发票配置表';

create table t_lending_instruction
(
    id          int            not null comment '主键'
        primary key,
    order_id    int            null comment '订单号',
    apply_no    varchar(60)    null comment '请款编号',
    amount      decimal(24, 6) null comment '放款金额',
    stage       varchar(60)    null comment '放款阶段（抽数、审核、申请、回盘）',
    status      int            null comment '放款状态（处理中、成功、失败、异常）',
    remark      varchar(60)    null comment '放款描述',
    apply_time  datetime       null comment '放款申请时间',
    reply_time  datetime       null comment '放款回盘时间',
    fund_driver varchar(60)    null comment '资方驱动器'
)
    comment '放款指令表';

create table t_mos_bill_info
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    bill_id      bigint                             not null comment '账单号',
    order_id     bigint                             not null comment '订单号',
    bill_type    smallint                           null comment '账单类型（1：普通账单；3：清贷账单）',
    bill_status  smallint                           null comment '账单状态(0:未结清 1:已结清',
    bill_index   int                                not null comment '期数',
    bill_date    date                               null comment '账单日',
    created_time datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint in_bill_id
        unique (bill_id)
)
    comment '综合订单贷后-账单表';

create index idx_bb
    on t_mos_bill_info (order_id, bill_index);

create table t_mos_business_info
(
    id                bigint unsigned auto_increment comment '主键'
        primary key,
    order_id          bigint                             not null comment '业务编号',
    vcredit_cust_id   varchar(50)                        null comment '集团客户号（用户中心）',
    loan_kind         varchar(50)                        null comment '产品',
    loan_capital      decimal(10, 2)                     null comment '贷款本金',
    loan_period       int                                null comment '贷款期数',
    loan_time         varchar(50)                        null comment '放贷日期',
    repayment_card_id varchar(50)                        null comment '还款卡id（用户中心）',
    is_repayment      tinyint  default 1                 not null comment '是否偿还中 1代表是 0代表不是',
    relative_date     date                               null comment '账单日',
    created_time      datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time      datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    clear_loan_time   datetime                           null comment '清贷日',
    sku               varchar(50)                        not null comment '产品端项目skv名称',
    loan_no           varchar(50)                        not null comment '借据号',
    business_id       varchar(50)                        null comment '统一流程业务号',
    deleted           tinyint  default 0                 null comment '是否删除',
    constraint in_order_id
        unique (order_id),
    constraint u_idx_lsd
        unique (loan_no, sku, deleted)
)
    comment '综合订单贷后-订单表';

create index id_c
    on t_mos_business_info (created_time);

create index id_lscd
    on t_mos_business_info (loan_no, sku, clear_loan_time, deleted);

create table t_mos_order_base_info
(
    id                   bigint unsigned auto_increment comment '主键'
        primary key,
    order_id             bigint                                not null comment '订单号',
    loan_amount          decimal(18, 6)                        not null comment '贷款金额',
    loan_period          tinyint                               not null comment '期数',
    loan_kind            varchar(50)                           not null comment '产品',
    sku                  varchar(50)                           not null comment '产品端项目skv名称',
    sign_time            varchar(50)                           not null comment '签约时间',
    loan_no              varchar(50)                           null comment '借据号',
    credit_serial_number varchar(50)                           null comment '授信流水号',
    transaction_id       varchar(50)                           null comment '交易流水号',
    loan_purpose         varchar(50)                           null comment '贷款用途',
    register_id          varchar(50)                           not null comment '客户注册号（用户中心）',
    vcredit_cust_id      varchar(50) default '0'               not null comment '集团客户号（用户中心）',
    repayment_card_id    varchar(50)                           null comment '还款卡id（用户中心）',
    loan_card_id         varchar(50)                           null comment '放款卡id（用户中心）',
    loan_serial_no       varchar(50)                           not null comment '放款流水号',
    loan_time            varchar(50)                           not null comment '放款时间',
    deleted              tinyint     default 0                 not null comment '是否删除（0有效，1删除）',
    created_time         datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    business_id          varchar(50) default ''                not null comment '业务号',
    constraint in_order_id
        unique (order_id),
    constraint loan_no
        unique (loan_no, sku),
    constraint loan_no_2
        unique (loan_no, sku, deleted)
)
    comment '综合订单基础信息表';

create index business_id
    on t_mos_order_base_info (business_id);

create index vcredit_cust_id
    on t_mos_order_base_info (vcredit_cust_id);

create table t_mos_received_info
(
    id            bigint unsigned auto_increment comment '主键'
        primary key,
    received_id   bigint                             not null comment '实收编号',
    order_id      bigint                             not null comment '订单编号',
    bill_id       bigint                             not null comment '帐单编号',
    subject       tinyint                            not null comment '科目',
    amount        decimal(10, 2)                     not null comment '金额',
    deduct_code   varchar(50)                        not null comment '还款流水号',
    received_time datetime                           not null comment '还款时间',
    created_time  datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    explains      varchar(100)                       null comment '操作说明',
    deleted       tinyint  default 0                 null comment '是否删除：0-未删除，1-删除',
    constraint in_received_id
        unique (received_id)
)
    comment '综合订单贷后-实收信息表';

create index idx_o_b
    on t_mos_received_info (order_id, bill_id);

create index idx_order_id
    on t_mos_received_info (order_id);

create table t_mos_repay_detail_info
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    detail_id    bigint                             not null comment '还款详情ID',
    repay_id     bigint                             not null comment '还款ID',
    subject      tinyint                            not null comment '科目类型',
    amount       decimal(10, 2)                     not null comment '资方还款金额',
    created_time datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint in_detail_id
        unique (detail_id)
)
    comment '综合订单贷后-还款流水详情表';

create table t_mos_repay_info
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    repay_id     bigint                             not null comment '还款ID',
    deduct_code  varchar(50)                        not null comment '还款流水号',
    order_id     bigint                             not null comment '业务号',
    bill_id      bigint                             not null comment '账单ID',
    bill_index   int                                not null comment '还款期数',
    repay_type   tinyint                            null comment '0：未设置；1：正常还款；2：提前还款；3：提前清贷；',
    amount       decimal(10, 2)                     not null comment '总金额',
    repay_date   datetime                           null on update CURRENT_TIMESTAMP comment '还款日期',
    remark       varchar(200)                       null comment '备注',
    created_time datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint in_repay_id
        unique (repay_id)
)
    comment '综合订单贷后-还款流水表';

create index idx_d
    on t_mos_repay_info (deduct_code);

create table t_mos_subject_info
(
    id            bigint unsigned auto_increment comment '主键'
        primary key,
    due_id        bigint                             not null comment '应收编号',
    due_serial_no varchar(50)                        not null,
    order_id      bigint                             not null comment '订单编号',
    bill_id       bigint                             not null comment '账单id',
    subject       tinyint(1)                         not null comment '科目',
    amount        decimal(10, 2)                     not null comment '金额 ',
    created_time  datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint in_due_id
        unique (due_id)
)
    comment '综合订单贷后-应收科目信息表';

create index idx_o
    on t_mos_subject_info (order_id);

create index idx_s_ob
    on t_mos_subject_info (order_id, bill_id);

create table t_mos_vfp_process
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id       bigint                                      not null comment '订单号',
    sku            varchar(50)                                 not null comment 'sku',
    step           int           default 0                     not null comment '步骤：0 初始化，1-49 处理阶段，，50 完成',
    deleted        tinyint       default 0                     not null comment '是否删除',
    created_time   datetime      default CURRENT_TIMESTAMP     not null comment '创建时间',
    updated_time   datetime      default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间',
    remark         varchar(2000) default ''                    not null comment '备注',
    operation_type tinyint       default 0                     not null comment '操作类型：0-未处理，1-处理中',
    last_run_time  datetime      default '1970-01-01 08:00:00' not null comment '当前步骤最后一次运行时间',
    handle_count   tinyint       default 0                     not null comment '处理次数',
    process_batch  bigint        default 0                     not null comment '处理批次，用于防止重复处理',
    constraint index_vfp_process_rlf
        unique (order_id, sku)
)
    comment '文件流程信息表';

create index index_vfp_process_step_sku
    on t_mos_vfp_process (step, sku, handle_count);

create table t_order
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    register_id  bigint unsigned default '0'               not null comment '用户中心id',
    vcid         varchar(20)     default ''                not null comment '身份信息id',
    order_type   varchar(10)     default ''                not null comment '订单类型：0--信贷 1--权益',
    order_source varchar(20)     default ''                not null comment '订单来源',
    group_id     bigint unsigned default '0'               not null comment '分组id',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    sys_tag      varchar(20)     default ''                not null comment '系统标识',
    constraint in_order_id
        unique (order_id)
)
    comment '订单表';

create index idx_vcid
    on t_order (vcid);

create table t_order_benefits
(
    id               bigint auto_increment comment '主键'
        primary key,
    product_code     varchar(200)   default ''                not null comment '渠道来源',
    order_id         bigint         default 0                 not null comment '购买订单号',
    benefits_type    tinyint        default 0                 null comment '权益类型：1.会员',
    benefits_subject varchar(100)   default ''                null comment '权益标的物 （比如普通会员，会存会员对应的code）',
    order_amount     decimal(10, 2) default 0.00              null comment '应支付金额',
    coupon_amount    decimal(10, 2) default 0.00              null comment '优惠券抵扣金额',
    actual_amount    decimal(10, 2) default 0.00              not null comment '实际支付金额',
    order_status     varchar(100)   default ''                not null comment '订单状态: (init:初始化, paying:支付中, paid:支付完成（支付完成，后续流程处理中） success:已完成, fail:已失败, cancel:取消)',
    activity_user_id bigint         default 0                 null comment '营销活动用户ID',
    duration         int                                      null comment '权益持续时间（按月为单位）',
    start_date       varchar(20)    default ''                null comment '权益生效时间 yyyy-mm-dd',
    end_date         varchar(20)    default ''                null comment '权益结束时间yyyy-mm-dd',
    buy_time         datetime       default CURRENT_TIMESTAMP not null comment '购买时间',
    is_deleted       tinyint(1)     default 0                 not null comment '是否删除: 0.否 1.是',
    created_time     datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime       default CURRENT_TIMESTAMP not null comment '更新时间',
    pay_bank_card_id bigint         default 0                 not null comment '银行卡id',
    fail_reason_code int            default 0                 not null comment '先享后付银行卡支付失败错误代码',
    appSerialNum     bigint         default 0                 not null comment '先享后付支付流水号',
    app_serial_num   bigint         default 0                 not null comment '先享后付支付流水号'
)
    comment '权益购买订单表';

create index idx_benefits_created_time
    on t_order_benefits (created_time);

create index idx_benefits_subject
    on t_order_benefits (benefits_subject);

create index idx_order_id
    on t_order_benefits (order_id)
    comment '订单号索引';

create index idx_order_status
    on t_order_benefits (order_status);

create table t_order_benefits_deduction_task
(
    id               bigint unsigned auto_increment comment '主键'
        primary key,
    order_id         bigint                                 not null comment '关联的购买订单号',
    benefits_subject varchar(100) default ''                null comment '权益标的物 （比如普通会员，会存会员对应的code）',
    start_time       datetime                               not null comment '开始时间',
    end_time         datetime                               not null comment '结束时间',
    task_status      tinyint(1)                             null comment '任务状态 0-待扣款，1-已扣款',
    collection_type  tinyint(1)   default 0                 not null comment '催收类型 0.不催收 1.AI催收',
    need_notify      tinyint(1)   default 1                 not null comment '是否推送消息 0.不推送 1.推送',
    notify_time      datetime                               null comment '发送批扣预提信息的时间节点',
    created_time     datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '扣款任务表';

create index idx_order_id
    on t_order_benefits_deduction_task (order_id);

create index idx_sms_send_time
    on t_order_benefits_deduction_task (notify_time);

create index idx_start_end_status
    on t_order_benefits_deduction_task (start_time, end_time);

create index idx_task_status
    on t_order_benefits_deduction_task (task_status);

create table t_order_benefits_refund
(
    id                bigint auto_increment comment '主键'
        primary key,
    order_id          bigint         default 0                 not null comment '退款订单号',
    purchase_order_id bigint         default 0                 not null comment '购买订单号',
    refund_reason     varchar(200)   default ''                null comment '退款原因',
    refund_amount     decimal(10, 2) default 0.00              not null comment '退款金额',
    refund_status     varchar(100)   default '0'               not null comment '退款状态: (init:初始化, refunding:退款中， success:退款成功， fail:退款失败)',
    refund_error_code varchar(200)                             null comment '退款失败原因',
    refund_time       datetime                                 null comment '退款时间',
    remark            varchar(200)                             null comment '备注',
    operator          varchar(200)                             null comment '操作人',
    refund_channel    tinyint(1)     default 0                 null comment '退款渠道  1.原路退回 2.vpc代付',
    app_serial_num    bigint         default 0                 null comment 'vpc代付交易流水号',
    is_deleted        tinyint(1)     default 0                 not null comment '是否删除: 0.否 1.是',
    created_time      datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time      datetime       default CURRENT_TIMESTAMP not null comment '更新时间',
    zdtk              varchar(10)    default ''                not null comment '主动退款标识'
)
    comment '权益退款订单表';

create index idx_order_id
    on t_order_benefits_refund (order_id)
    comment '订单号索引';

create index idx_refund_status
    on t_order_benefits_refund (refund_status);

create table t_order_contract_record
(
    id              bigint unsigned auto_increment comment '主键'
        primary key,
    order_id        bigint unsigned default '0'               not null comment '订单号',
    contract_status varchar(20)     default ''                not null comment '合同状态 init:初始化;buildPending:合同生成中;buildFail:合同生成失败;buildSuccess:合同生成成功;uploadPending:合同上传中;uploadFail:合同上传失败;uploadSuccess:合同上传成功',
    point           tinyint         default 2                 not null comment '上传节点(1-预审前 2-放款前 3-放款后 4改卡前 5改卡后)',
    business_scene  tinyint         default 2                 not null comment '业务场景（1-预审 2-放款 3-改卡 4-贷后函件）',
    enable_flag     varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time    datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time    datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单合同记录表';

create index idx_order_id
    on t_order_contract_record (order_id)
    comment '订单id';

create table t_order_credit
(
    id                             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id                       bigint unsigned default '0'               not null comment '订单号',
    amount                         decimal(20, 6)  default 0.000000          not null comment '申请金额(元)',
    period tinyint default 0 not null comment '申请期数',
    credit_order_type              tinyint         default 0                 not null comment '信贷类型：0-未知 1--首贷 2--加贷 3--再贷',
    risk_loan_type                 varchar(10)     default '0'               not null comment '风控定义的贷款类型(0-未知 1.首贷 2.加贷 3.再贷 4.首笔非首贷)',
    flow_id                        varchar(20)     default ''                not null comment '流程id',
    process_id                     varchar(20)     default ''                not null comment '授信流水号',
    product_code                   varchar(20)     default ''                not null comment '产品编码',
    fund_code                      varchar(20)     default ''                not null comment '资方编码',
    fund_source                    varchar(20)     default ''                not null comment '资方来源',
    channel_code                   varchar(20)     default ''                not null comment '渠道信息',
    order_status                   varchar(20)     default ''                not null comment '订单状态(init:初始化,confirm:订单确认,pendingLoan:待放款,loaning:放款中,migration:订单待迁移,loaned:已放款,normalRepayment:正常还款,clearUp:订单结清,terminate:解约)',
    loan_purpose                   varchar(20)     default ''                not null comment '放款用途',
    loan_date                      varchar(40)     default ''                not null comment '放款时间',
    loan_action_type               tinyint         default 0                 not null comment '放款类型(0-未知 1-借现金，2-代还信用卡,3-零花钱)',
    reason_code                    varchar(20)     default ''                not null comment '原因编码（200000-提现决策拒绝,200001-提现决策拒绝-单次拒绝,200002-提现决策拒绝-可交单拒绝,200003-提现决策拒绝-设备分拒绝,200004-提现决策拒绝-公安网纹比对拒绝,200005-提现决策拒绝-预决策拒绝,200006-提现决策拒绝-征信拒绝,200007-提现决策拒绝-主决策拒绝,200008-提现决策拒绝-B决策拒绝,300000-资方预审拒绝,400000-电审拒绝,400001-电审拒绝-征信报告资质不佳,400002-电审拒绝-手机报告报告不佳,400003-电审拒绝-电话核查不符,400004-电审拒绝-外部数据异常,400005-电审拒绝-资料不符,400006-电审拒绝-客户取消,400007-电审拒绝-共债,400008-电审拒绝-关注名单,400009-电审拒绝-其他,400010-电审拒绝-签名不符合,400011-电审拒绝-银行卡放款失败,400012-电审拒绝-资方原因,400013-电审拒绝-放款检查不通过,400014-电审拒绝-电审决策拒绝,500000-交单拒绝,600000-放款失败拒绝,600001-放款失败拒绝-非卡原因,600002-放款失败拒绝-卡原因,900000-其他原因拒绝）',
    terminate_reason               varchar(100)    default ''                not null comment '解约原因',
    clear_date                     varchar(40)     default ''                not null comment '订单结清日期',
    sign_date                      varchar(40)     default ''                not null comment '签约日期',
    created_time                   datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time                   datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    supply_loan_purpose            varchar(20)     default ''                not null comment '补充放款用途',
    op_channel_code                varchar(20)     default ''                not null comment '操作渠道',
    whether_in_app                 varchar(10)     default ''                not null comment '端外0,端内1',
    supply_product_code            varchar(20)                               null comment '附属产品编码',
    capital_project_version_no     varchar(32)     default ''                not null,
    period_type                    tinyint(1)      default (1)               not null comment '申请期数类型  1:month;2:day',
    contract_number                varchar(50)     default ''                not null comment '合同编号',
    model_key                      varchar(32)     default ''                not null comment '模式信息',
    capital_project_code           varchar(30)                               null,
    sub_capital_project_code       varchar(30)                               null,
    sub_capital_project_version_no varchar(20)     default ''                not null comment 'subCapitalProjectVersionNo',
    constraint in_credit_order_id
        unique (order_id)
)
    comment '信贷订单表';

create table t_order_credit_bank_card
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id       bigint unsigned default '0'               not null comment '订单号',
    bank_card_id   bigint unsigned default '0'               not null comment '用户中心业务线银行卡ID',
    bank_card_used varchar(10)     default ''                not null comment '银行卡用途：repay--还款 loan--放款',
    enable_flag    varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time   datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time   datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单银行卡信息表';

create index in_card_order_id
    on t_order_credit_bank_card (order_id);

create table t_order_credit_contact
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    contact_id   bigint unsigned default '0'               not null comment '用户中心联系人信息id(业务线ID）',
    enable_flag  varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单联系人信息表';

create index in_contact_order_id
    on t_order_credit_contact (order_id);

create table t_order_credit_contract
(
    id                 bigint unsigned auto_increment comment '主键'
        primary key,
    order_id           bigint unsigned default '0'               not null comment '订单号',
    contract_id        varchar(40)     default ''                not null comment '合同id',
    contract_type      varchar(40)     default ''                not null comment '合同类型',
    contract_type_name varchar(40)     default ''                not null comment '合同类型名称',
    enable_flag        varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time       datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time       datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单合同表';

create index in_contract_order_id
    on t_order_credit_contract (order_id);

create table t_order_credit_coupon
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    coupon_no    varchar(40)     default ''                not null comment '营销中心id',
    enable_flag  varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单券信息表';

create index in_coupon_order_id
    on t_order_credit_coupon (order_id);

create table t_order_credit_extend
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    extend_name  varchar(20)     default ''                not null comment '名称',
    extend_id    varchar(20)     default ''                not null comment '各中心对应表主键id',
    extend_flag  varchar(200)    default ''                not null comment '标签',
    enable_flag  varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单拓展表';

create index idx_order_id_extend_name
    on t_order_credit_extend (order_id, extend_name);

create index in_extend_order_id
    on t_order_credit_extend (order_id);

create table t_order_credit_loan
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id       bigint unsigned default '0'               not null comment '订单号',
    batch_no       varchar(50)     default ''                not null comment '放款批次号',
    iou_no         varchar(200)    default ''                not null comment '借款借据号',
    loan_time      varchar(20)     default ''                not null comment '请款时间',
    status         varchar(10)     default ''                not null comment '状态 success:成功,fail:失败,pending:处理中,compensate:补偿处理',
    reason_code    varchar(10)     default ''                not null comment '拒绝原因',
    message        varchar(200)    default ''                not null comment '原因',
    handler_type   varchar(20)     default ''                not null comment '处理方式 autoTerminate:自动解约',
    handler_result varchar(20)     default ''                not null comment '处理方式 success:成功,fail:失败,pending:处理中',
    enable_flag    varchar(4)      default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time   datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time   datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单放款表';

create index idx_order_id
    on t_order_credit_loan (order_id)
    comment '订单id';

create table t_order_credit_message_config
(
    id                   bigint unsigned auto_increment comment '主键'
        primary key,
    capital_project_code varchar(200)                           not null comment '资方编码',
    capital_project_name varchar(200)                           not null comment '资方名称',
    message              varchar(200) default ''                not null comment '原因集合',
    matched_value        varchar(200) default ''                not null comment '匹配值',
    message_type         varchar(20)  default ''                not null comment '信息类型 loan_fail_bank_message:放款失败银行卡原因',
    enable_flag          varchar(4)   default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time         datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单放款原因配置表';

create table t_order_credit_process
(
    id             bigint unsigned auto_increment comment '主键'
        primary key,
    order_id       bigint unsigned default '0'               not null comment '订单号',
    process_name   varchar(20)     default ''                not null comment '流程名（fundRoute:预筛选后路由,preApproval:预审批,withDrawApply:提现决策,auditApply:电审,pushPreOrder:预交单,pushOrder:交单,loan:放款）',
    process_status varchar(10)     default ''                not null comment '流程状态',
    process_id     varchar(32)     default ''                not null comment '流程id',
    descr          varchar(200)    default ''                not null comment '描述',
    enable_flag    varchar(10)     default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time   datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time   datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '信贷订单流程表';

create index idx_process_id
    on t_order_credit_process (process_id)
    comment 'idx_process_id';

create index idx_ps_pn
    on t_order_credit_process (process_status, process_name);

create index in_process_order_id
    on t_order_credit_process (order_id);

create table t_order_credit_rate
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    rate_type    varchar(20)     default ''                not null comment '费率类型',
    rate_value   decimal(20, 10) default 0.0000000000      not null comment '费率值',
    enable_flag  varchar(4)      default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单费率表';

create index idx_order_id
    on t_order_credit_rate (order_id)
    comment '订单id';

create table t_order_credit_rule_config
(
    id                  bigint unsigned auto_increment comment '主键'
        primary key,
    fund_code           varchar(20) default ''                not null comment '资方编码',
    label               varchar(20) default ''                not null comment '标签',
    supply_product_code varchar(20) default ''                not null comment '附属产品编码',
    enable_flag         varchar(4)  default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time        datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time        datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '子产品规则匹配表';

create table t_order_gzfile_info
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '信贷订单号',
    ecm_id       varchar(100)    default ''                not null comment 'ecmId',
    file_name    varchar(100)    default ''                not null comment '文件名',
    file_use     varchar(200)    default ''                not null comment '文件用途',
    enable_flag  varchar(2)      default '0'               not null comment '有效标记，0-有效，1-无效',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    uuid         varchar(100)    default ''                not null comment '文件随机生成数',
    register_id  bigint          default 0                 not null comment '注册id',
    file_type    varchar(100)    default ''                not null comment '文件类型'
);

create table t_order_loan_fail_config
(
    id                   bigint unsigned auto_increment comment '主键'
        primary key,
    capital_project_code varchar(30)  default ''                not null comment '资方编码',
    fund_name            varchar(20)  default ''                not null comment '资方名称',
    message              varchar(200) default ''                not null comment '原因集合 多个|分割',
    handler_type         varchar(20)  default ''                not null comment '处理方式 autoTerminate:自动解约',
    enable_flag          varchar(2)   default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time         datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单放款失败处理配置表';

create table t_order_migration_record
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    old_order_id bigint unsigned default '0'               not null comment '老订单号',
    new_order_id bigint unsigned default '0'               not null comment '新订单号',
    product_code varchar(20)     default ''                not null comment '产品code',
    status       varchar(20)     default ''                not null comment '状态 init:待迁移,pending:迁移中,success:迁移成功,fail:迁移失败',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    enable_flag  varchar(4)      default '1'               not null comment '有效标记：(0 无效 1有效)'
)
    comment '订单迁移记录表';

create index idx_new_order_id
    on t_order_migration_record (new_order_id)
    comment '新订单id';

create index idx_old_order_id
    on t_order_migration_record (old_order_id)
    comment '老订单id';

create table t_order_sync
(
    id                bigint unsigned auto_increment comment '主键'
        primary key,
    order_id          bigint unsigned default '0'               not null comment '订单号',
    register_id       bigint unsigned default '0'               not null comment '用户中心注册号',
    original_order_id varchar(20)     default ''                not null comment '原系统orderId',
    sync_status       varchar(20)     default ''                not null comment '同步状态',
    sync_result_desc  varchar(40)     default ''                not null comment '同步结果描述',
    batch_number      varchar(20)     default ''                not null comment '批次号',
    created_time      datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time      datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    product_code      varchar(20)     default ''                not null comment '产品编码，ddq-豆豆钱，ddfr-豆豆分润',
    constraint ui_order_id
        unique (order_id)
)
    comment '订单同步表';

create table t_order_tag
(
    id                            bigint auto_increment comment '主键'
        primary key,
    order_id                      bigint                                       not null comment '订单号',
    capital_project_code          varchar(32)    default ''                    not null comment '资金项目编码',
    capital_project_version_no    varchar(32)    default ''                    not null comment '资金项目版本号',
    receipt_version               varchar(50)    default ''                    not null comment '借款借据版本',
    period_kind                   tinyint(1)     default 1                     not null comment '贷款期限类型;1:month;2:day',
    relative_date                 date                                         null comment '相对账单日',
    agreed_clear_loan_time        datetime                                     null comment '自然结清日期',
    next_bill_date                datetime                                     null comment '下一账单日',
    is_repayment                  tinyint(1)     default 0                     not null comment '是否偿还中;1:是 0:不是',
    business_status               tinyint(1)     default 1                     not null comment '业务状态;1、正常 2、代偿 3、诉讼 5、回购 6、解约',
    compensatory_type             tinyint(1)     default 0                     not null comment '代偿类型;0-未代偿、1-普通债转、2-外贸特殊债券转让、3-包外债转、4-原装分配、5-质保债转、6-特殊切回我司扣标记、7-转担保、8-转担保后债转',
    compensatory_date             datetime       default '1970-01-01 00:00:00' not null comment '代偿日期',
    guarantee_num                 varchar(50)    default ''                    not null comment '担保批次',
    lawsuit_status                tinyint(1)     default 1                     not null comment '诉讼执行状态;1、未诉讼 2、诉讼中 3、诉讼完成 4、申请执行 5、执行一次 6、执行二次',
    to_litigation_time            datetime       default '1970-01-01 00:00:00' not null comment '转诉讼日期',
    lawsuit_code                  varchar(50)    default ''                    not null comment '判决案号(诉讼订单使用)',
    clear_state                   tinyint(1)     default 1                     not null comment '清贷状态;1、偿还中  2、满约清贷 3、提前清贷 4、坏帐清贷 5、提前清贷申请 6、坏账申请 7、提前清贷中',
    actual_clear_loan_time        datetime       default '1970-01-01 00:00:00' not null comment '实际清贷时间',
    freezing_code                 varchar(100)   default ''                    not null comment '冻结码',
    over_month                    int            default 0                     not null comment '逾期月数',
    over_amount                   decimal(18, 2) default 0.00                  not null comment '逾期欠费',
    bad_debt_stamp                tinyint(1)     default 0                     not null comment '坏账标记',
    bad_debt_create_time          datetime       default '1970-01-01 00:00:00' not null comment '坏账标记时间',
    distressed_asset_flag         tinyint(1)     default 0                     not null comment '不良资产标记;1.不良资产',
    distressed_asset_remark       varchar(100)   default ''                    null comment '不良资产备注',
    distressed_asset_side_code    varchar(20)    default ''                    not null comment '不良资产受让方编码',
    distressed_create_time        datetime       default '1970-01-01 00:00:00' not null comment '不良标记时间',
    clear_loan_white_start_time   datetime                                     null comment '清贷开始时间',
    clear_loan_white_end_time     datetime                                     null comment '清贷结束时间',
    add_clear_loan_white_operator varchar(100)                                 null comment '添加清贷白名单操作人',
    add_clear_loan_white_flag     smallint       default 0                     not null comment '0 失败 1成功',
    add_clear_loan_bus_types      smallint                                     null comment '清贷白名单类型1-主动还款后不能清贷(乌鲁木齐),2 -反洗钱黑名单',
    created_time                  datetime       default CURRENT_TIMESTAMP     not null comment '创建时间',
    updated_time                  datetime       default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间',
    over_month_update_time        datetime       default '1970-01-01 00:00:00' not null comment 'over_month更新时间'
)
    comment '订单放款后扩展表';

create index idx_capital_code_version
    on t_order_tag (capital_project_code, capital_project_version_no);

create index idx_created_time
    on t_order_tag (created_time);

create index idx_freezing_code
    on t_order_tag (freezing_code);

create index uidx_order_id
    on t_order_tag (order_id);

create table t_order_tag_copy1
(
    id                         bigint auto_increment comment '主键'
        primary key,
    order_id                   bigint                                     not null comment '订单号',
    capital_project_code       varchar(32)  default ''                    not null comment '资金项目编码',
    capital_project_version_no varchar(32)  default ''                    not null comment '资金项目版本号',
    receipt_version            varchar(50)  default ''                    not null comment '借款借据版本',
    period_kind                tinyint(1)   default 1                     not null comment '贷款期限类型;1:month;2:day',
    relative_date              date                                       not null comment '相对账单日',
    agreed_clear_loan_time     datetime                                   not null comment '自然结清日期',
    next_bill_date             datetime                                   not null comment '下一账单日',
    is_repayment               tinyint(1)   default 1                     not null comment '是否偿还中;1代表是 0代表不是',
    business_status            tinyint(1)   default 1                     not null comment '业务状态;1、正常 2、代偿 3、诉讼 5、回购 6、解约',
    compensatory_type          tinyint(1)   default 0                     not null comment '代偿类型;0-未代偿、1-普通债转、2-外贸特殊债券转让、3-包外债转、4-原装分配、5-质保债转、6-特殊切回我司扣标记、7-转担保、8-转担保后债转',
    compensatory_date          datetime     default '1970-01-01 00:00:00' not null comment '代偿日期',
    guarantee_num              varchar(50)  default ''                    not null comment '担保批次',
    lawsuit_status             tinyint(1)   default 1                     not null comment '诉讼执行状态;1、未诉讼 2、诉讼中 3、诉讼完成 4、申请执行 5、执行一次 6、执行二次',
    to_litigation_time         datetime     default '1970-01-01 00:00:00' not null comment '转诉讼日期',
    lawsuit_code               varchar(50)  default ''                    not null comment '判决案号（诉讼订单使用）',
    clear_state                tinyint(1)   default 1                     not null comment '清贷状态;1、偿还中  2、满约清贷 3、提前清贷 4、坏帐清贷 5、提前清贷申请 6、坏账申请 7、提前清贷中',
    actual_clear_loan_time     datetime     default '1970-01-01 00:00:00' not null comment '实际清贷时间',
    freezing_code              varchar(50)  default ''                    not null comment '冻结码',
    over_month                 int          default 1                     not null comment '逾期月数',
    over_amount                decimal(18, 2)                             not null comment '逾期欠费',
    bad_debt_stamp             tinyint(1)   default 0                     not null comment '坏账标记',
    bad_debt_create_time       datetime     default '1970-01-01 00:00:00' not null comment '坏账标记时间',
    distressed_asset_flag      tinyint(1)   default 0                     not null comment '不良资产标记;1.不良资产',
    distressed_asset_remark    varchar(100) default ''                    not null comment '不良资产备注',
    distressed_asset_side_code varchar(20)  default ''                    not null comment '不良资产受让方编码',
    create_time                datetime     default CURRENT_TIMESTAMP     not null comment '创建时间',
    update_time                datetime     default CURRENT_TIMESTAMP     not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '订单放款后扩展表';

create table t_order_user_coupon
(
    id                 bigint auto_increment comment '主键'
        primary key,
    order_id           bigint                                   not null comment '订单号',
    period int default 1 not null comment '期数',
    user_coupon_id     varchar(36)    default ''                not null comment '券ID',
    user_coupon_no     varchar(36)    default ''                not null comment '券编号',
    free_periods       varchar(64)    default ''                not null comment '券发放期数',
    discount_category  varchar(20)    default ''                not null comment '券优惠类目  优惠类目：0通用、1担保费、2保障服务费、3服务咨询费 多个以,隔开',
    coupon_type        varchar(4)     default ''                not null comment '券类型 关怀类型，1：逾期关怀 2：主动关怀 3：提前结清关怀',
    coupon_kind        varchar(20)    default ''                not null comment '息费券种别（枚举关联）',
    coupon_value       decimal(10, 2) default 0.00              not null comment '减免数额（金额、折扣率）',
    coupon_used_amount decimal(10, 2) default 0.00              not null comment '实际减免数额',
    coupon_status      int            default 0                 not null comment '券状态（0-不可用，1-可用）',
    coupon_used_status int            default 0                 not null comment '券使用状态（0-初始，1-用券失败，2-用券成功）',
    coupon_fail_code   varchar(4)     default ''                not null comment '错误编号',
    due_date           int            default 0                 not null comment '券有效期，单位天',
    end_time           datetime                                 null comment '券可用截止日期',
    push_status        int            default 0                 not null comment '回推状态0-未推送；1-已推送',
    created_time       datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time       datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '优惠券记录表';

create index idx_created_time
    on t_order_user_coupon (created_time);

create index idx_order_id
    on t_order_user_coupon (order_id);

create table t_order_vbs_mapping
(
    id           bigint unsigned auto_increment comment '主键'
        primary key,
    order_id     bigint unsigned default '0'               not null comment '订单号',
    vbs_bid      bigint unsigned default '0'               not null comment 'vbs业务号',
    sync_status  varchar(1)      default '0'               not null comment '同步状态，0-未同步，1-已同步订单授信关系，2-已同步客户标签',
    created_time datetime        default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime        default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint idx_vbs_bid
        unique (vbs_bid)
)
    comment '信贷订单临时表';

create index idx_sync_status
    on t_order_vbs_mapping (sync_status);

create index in_mapping_order_id
    on t_order_vbs_mapping (order_id);

create table t_payment_alipay_config
(
    id              bigint unsigned                         not null comment '主键'
        primary key,
    benefits_type   tinyint       default 0                 not null comment '权益类型',
    app_id          varchar(50)   default ''                not null comment '支付宝appId',
    app_name        varchar(20)   default ''                not null comment '商户号名称',
    app_card_no     varchar(255)  default ''                not null comment '商户号卡号',
    app_code        varchar(10)                             not null comment '商户编码',
    shop_no         varchar(50)   default ''                not null comment '商户号',
    zsftd           varchar(10)                             not null comment '支付宝三方通道',
    public_key      varchar(5000) default ''                not null comment '公钥',
    private_key     varchar(5000) default ''                not null comment '私钥',
    is_default      tinyint(1)    default 1                 not null comment '是否为默认支付账号（0.否，1.是）',
    is_last         tinyint(1)    default 0                 not null comment '是否为最新 0否 1.是',
    management_code varchar(10)   default ''                not null comment '资方编码',
    management_name varchar(50)   default ''                not null comment '资方描述',
    is_deleted      tinyint(1)    default 0                 not null comment '是否删除 0否 1是',
    created_time    datetime      default CURRENT_TIMESTAMP not null comment '创能时间',
    updated_time    datetime      default CURRENT_TIMESTAMP not null comment '更新时间'
)
    comment '支付宝配置表';

create table t_payment_record
(
    id                  bigint auto_increment comment '主键'
        primary key,
    order_id            bigint       default 0                 not null comment '订单号',
    amount              decimal(10, 2)                         not null comment '支付金额',
    pay_status          tinyint(1)   default 0                 not null comment '支付状态: 1.支付中 2.已支付 3.支付失败',
    pay_channel         tinyint      default 0                 not null comment '支付渠道：1.支付宝 ',
    pay_sequence_no     varchar(100) default ''                not null comment '支付流水号 （支付宝交易号或者微信交易号）',
    pay_config_id       bigint       default 0                 null comment '支付配置ID',
    remark              varchar(200) default ''                null comment '备注',
    is_deleted          tinyint(1)   default 0                 not null comment '是否删除: 0.否 1.是',
    created_time        datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time        datetime     default CURRENT_TIMESTAMP not null comment '更新时间',
    vpc_id              varchar(100)                           null comment 'vbs与支付宝交易流水号',
    platform_serial_num varchar(100) default ''                not null comment '宝付交易流水号'
)
    comment '支付明细表';

create index idx_order_id
    on t_payment_record (order_id);

create table t_pre_approval_data_extraction
(
    id                   varchar(30)    default ' '    not null comment '预审批ID',
    route_token          varchar(50)    default ''     not null comment '路由认证令牌',
    thread_id            varchar(40)    default ''     not null comment '进程编号',
    product_code         varchar(30)    default ''     not null comment '产品id',
    sub_product_code     varchar(30)    default ''     not null comment '子产品id',
    capital_project_code varchar(30)                   null,
    fund_source          varchar(30)    default ''     not null comment '资方名称',
    id_no                varchar(128)   default ''     not null comment '身份证号码',
    trust_plan_id        varchar(5)     default ''     not null comment '信托计划id',
    apply_period         varchar(5)     default ''     not null comment '申请期数',
    apply_amount         decimal(10, 4) default 0.0000 not null comment '申请金额',
    loan_type            varchar(30)    default ''     not null comment '贷款类型',
    position             tinyint        default 0      not null comment '路由位置',
    reason_code          varchar(10)    default ''     not null comment '预审失败码',
    status               varchar(30)    default ''     not null comment '状态',
    message              varchar(640)   default ''     not null comment '资方预审反馈信息',
    created_time         datetime                      null comment '预审批发起时间',
    completed_time       datetime                      null comment '预审完成时间',
    status_time          datetime                      null comment '预审批最后一次状态更新时间',
    updated_time         datetime                      null comment '此表数据最后更新时间',
    num_id               int unsigned auto_increment comment '主键'
        primary key,
    vfp_fund_source_code varchar(30)    default ''     not null comment '资金包编码',
    vfp_fund_source_name varchar(30)    default ''     not null comment '资金包名称',
    versions_no          varchar(12)    default ''     not null comment '加密版本号',
    create_date          varchar(30)    default ''     not null comment '同步时间(yyyy-MM-dd)'
)
    comment '数据提取表';

create index created_time
    on t_pre_approval_data_extraction (created_time);

create index id
    on t_pre_approval_data_extraction (id);

create index idx_completed_time
    on t_pre_approval_data_extraction (completed_time);

create index idx_completed_time_code
    on t_pre_approval_data_extraction (completed_time, capital_project_code);

create index idx_created_time_code
    on t_pre_approval_data_extraction (created_time, vfp_fund_source_code);

create index idx_id_no
    on t_pre_approval_data_extraction (id_no);

create index idx_route_token
    on t_pre_approval_data_extraction (route_token);

create index idx_status
    on t_pre_approval_data_extraction (status);

create index idx_updated_time
    on t_pre_approval_data_extraction (updated_time);

create table t_repayment_relief_config
(
    id                   bigint auto_increment comment '主键'
        primary key,
    loan_kind            varchar(30) default ''                not null comment '产品编码',
    capital_project_code varchar(30) default ''                not null comment 'VOS侧资方编码',
    lending_side_key     varchar(30) default ''                not null comment 'VBS侧资方编码',
    name                 varchar(20) default ''                not null comment '资方名称/产品名称',
    remark               varchar(50) default ''                not null comment '备注',
    subject_id           int         default 0                 not null comment '科目号(1-本金 2-利息 3-罚息...), 如果科目号为0，则',
    reducible_stage      tinyint     default 0                 not null comment '可减免阶段: 0-不可减免, 1-担保前后均可 2-仅担保后',
    not_advance_bill     tinyint(1)  default 0                 not null comment '担保前，账单代垫状态是否支持：0-无需考虑,1-需未代垫 ',
    benefit_flag         tinyint(1)  default 0                 not null comment '该科目 受益方是方为资方：0-减免(我司）, 1-减免资(资方) ',
    enable_flag          varchar(4)  default '1'               not null comment '有效标记：(0 无效 1有效)',
    created_time         datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '减免还款配置表';

create index idx_lending_side_key_subject_id_benefit_flag
    on t_repayment_relief_config (lending_side_key, subject_id, benefit_flag);

create index idx_loan_kind
    on t_repayment_relief_config (loan_kind);

create index idx_reducible_stage_not_advance_bill
    on t_repayment_relief_config (reducible_stage, not_advance_bill);

create table t_route_capital_config
(
    id                       bigint auto_increment comment '自增主键'
        primary key,
    capital_project_code     varchar(30)      null,
    capital_name             varchar(20)      null comment '资金模式名称',
    product_code             varchar(20)      null comment '产品code',
    sub_product_code         varchar(20)      null comment '子产品code',
    enable_flag              tinyint unsigned null comment '有效标识(0 无效 1有效)',
    stride_product           tinyint          null comment '审批结果是否可跨产品',
    passed_valid_days        int              null comment '审批通过有效期',
    rejected_valid_days      int              null comment '审批拒绝时效',
    required_inq_credit      tinyint          null comment '是否需要查征',
    required_sign_nucc       tinyint          null comment '是否需签署网签协议',
    required_upload_document tinyint          null comment '是否需要上传影像文件',
    max_upload_timeout_time  tinyint          null comment '最大文件上传超时时间，单位 秒',
    upload_sync_flag         tinyint          null comment '0--文件由单独接口上传 1--文件作为预审批接口的参数上传',
    loan_freq                varchar(10)      null comment '资方还款间隔',
    pre_approval_dimension   varchar(10)      null comment '预审批维度：0--订单维度 1--客户维度',
    maximum_amount           bigint           null comment '资方每日最大限额金额（万元）',
    capital_abbr             varchar(100)     null comment '资金简称',
    pre_approval_start_time  varchar(20)      null comment '资方预审批开始时间（筛选时间）',
    pre_approval_end_time    varchar(20)      null comment '资方预审批结束时间（筛选时间）',
    sort_no                  int              null comment '排序号码',
    status                   int default 1    null comment '资方配置状态 1:上线 2：下线',
    rate_range               varchar(255)     null comment '排除费率',
    created_time             datetime         null comment '创建时间',
    updated_time             datetime         null comment '更新时间'
)
    comment '路由资产配置表（资产维度）';

create table t_route_capital_group
(
    id               bigint auto_increment comment '自增主键'
        primary key,
    group_name       varchar(50)      null comment '资金模式名称',
    product_code     varchar(20)      null comment '产品code',
    sub_product_code varchar(20)      null comment '子产品code',
    priority         tinyint          null comment '优先级',
    status           tinyint          null comment '1- 上线 2-下线，',
    enable_flag      tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time     datetime         null comment '创建时间',
    updated_time     datetime         null comment '更新时间'
)
    comment '资产组信息表';

create table t_route_capital_group_mapping
(
    id                bigint auto_increment comment '自增主键'
        primary key,
    group_id          bigint           null comment '资金模式名称',
    capital_config_id bigint           null comment '产品code',
    priority          tinyint          null comment '优先级',
    enable_flag       tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time      datetime         null comment '创建时间',
    updated_time      datetime         null comment '更新时间',
    constraint t_route_capital_group_mapping_UN
        unique (capital_config_id, group_id)
)
    comment '资产组配置关系表';

create index config_id
    on t_route_capital_group_mapping (capital_config_id);

create index group_id
    on t_route_capital_group_mapping (group_id);

create table t_route_capital_list
(
    id                   bigint auto_increment comment '自增主键'
        primary key,
    route_auth_token     varchar(50)      null comment '路由token',
    capital_project_code varchar(30)      null,
    position             tinyint          null comment '路由位置',
    audit_status         varchar(20)      null comment '预审批状态',
    audit_apply_no       varchar(40)      null comment '资方申请流水号',
    external_no          varchar(40)      null comment '外部申请流水号',
    skip_reason          varchar(20)      null comment '预审跳过原因',
    audit_start_time     datetime         null comment '预审开始时间',
    audit_end_time       datetime         null comment '预审结束时间',
    enable_flag          tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time         datetime         null on update CURRENT_TIMESTAMP comment '创建时间',
    updated_time         datetime         null on update CURRENT_TIMESTAMP comment '更新时间',
    version_no           varchar(30)      null comment '交易模式版本号',
    contract_no          varchar(40)      null comment '合同号',
    message              varchar(255)     null comment '流程信息',
    trans_project_code   varchar(30)      null,
    trans_version_no     varchar(50)      null comment '交易结构节点版本号'
)
    comment '路由明细表，存储资方维度的路由信息，与route_info为多对一关系';

create index audit_apply_no
    on t_route_capital_list (audit_apply_no);

create index capital_model_code
    on t_route_capital_list (capital_project_code);

create index route_auth_token
    on t_route_capital_list (route_auth_token);

create table t_route_cash_reuse_criteria
(
    ID                   bigint auto_increment comment 'id'
        primary key,
    reuse_type           varchar(100)                           not null comment '头寸复用类型 1.头寸富余, 2头寸超额',
    capital_project_code varchar(100)                           null,
    regulation           varchar(1000)                          not null comment '复用条件',
    enabled_flag         tinyint(1)   default 1                 not null,
    created_time         datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime     default CURRENT_TIMESTAMP not null comment '更新时间',
    create_by            varchar(100) default ''                not null comment '创建人',
    update_by            varchar(100)                           null comment '更新人',
    excess_type          tinyint                                null comment '每日超额类型 1.次日头寸 2.固定金额 0默认为0，当为头寸超额时为必输',
    excess_amount        decimal(20, 4)                         null comment '超额投放金额'
)
    comment '头寸复用条件表';

create table t_route_cash_transfer_criteria
(
    Id                   bigint auto_increment comment '主键'
        primary key,
    capital_project_code varchar(30)                        null,
    regulation           varchar(1000)                      not null comment '规则条件',
    transfer             varchar(20)                        not null comment '资金来源产品',
    transfer_rate        double                             not null comment '资金转移所占资产限额比例',
    target               varchar(20)                        not null comment '目标产品',
    execute_time         datetime                           null comment '执行时间，为当日时间表示已执行，不为当日时间表示未执行或未触发',
    created_time         datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    enabled_flag         int      default 1                 not null comment '是否可用 0 不可用,1可用'
)
    comment '头寸转移条件表(资方卡豆产品，当日卡豆授信额度使用复核一定条件时，可实现卡豆限额比例金额的转移)';

create table t_route_config
(
    id           bigint auto_increment comment '主键'
        primary key,
    remark       varchar(200)                       not null comment '配置备注名',
    value        varchar(400)                       not null comment '配置值',
    `key`        varchar(50)                        not null comment '配置key',
    enable_flag  tinyint(1)                         not null comment '是否启用该条配置',
    created_time datetime default CURRENT_TIMESTAMP not null comment '配置创建时间',
    updated_time datetime default CURRENT_TIMESTAMP not null comment '配置修改时间'
)
    comment '路由规则枚举表';

create table t_route_credit_info
(
    id                   bigint auto_increment comment '自增主键'
        primary key,
    route_auth_token     varchar(64)      null comment '路由token',
    capital_project_code varchar(30)      null,
    process_id           varchar(64)      null comment '授信流程id',
    credit_status        varchar(20)      null comment '授信结果',
    report_id            bigint           null comment '报告id',
    report_sn            varchar(64)      null comment '报告sn',
    credit_type          tinyint          null comment '报告类型',
    apply_id             bigint           null comment '申请id',
    query_reason         varchar(64)      null comment '查询原因',
    credit_source        varchar(32)      null comment '授权查征，贷后查征',
    credit_query_type    tinyint          null comment '征信查询类型 (1:缓存查询征信，2：新查询征信)',
    serial_no            varchar(64)      null comment '查征流水号',
    error_reason         varchar(128)     null comment '错误描述',
    enable_flag          tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time         datetime         null comment '创建时间',
    updated_time         datetime         null comment '更新时间'
)
    comment '表名：理由';

create table t_route_decision_rate_param
(
    id                         bigint unsigned auto_increment comment '费率决策出参编号'
        primary key,
    route_auth_token           varchar(50) default ''                not null comment '客户路由凭证',
    capital_project_code       varchar(30)                           null,
    really_monthly_rate        decimal(8, 6)                         not null comment '实际月利率',
    up_front_rate              decimal(16, 6)                        not null comment '前置操作费率',
    decision_upfront_label     varchar(20) default ''                not null comment '费率决策出的Upfront标签',
    created_time               timestamp                             null comment '创建时间',
    updated_time               datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    monthly_rate_flag          varchar(2)  default '1'               not null comment '校验月利率异常标志（用于路由阶段是否跳过该资方的判断，0-异常 1-正常）',
    nominal_combined_rate      decimal(8, 6)                         not null comment '名义月利率',
    real_combined_rate         decimal(8, 6)                         not null comment '实际月利率',
    pre_decision_rate_range    varchar(20) default ''                not null comment '费率预决策出的费率区间',
    is_favorable_rate_customer varchar(10) default ''                not null comment '是否费率优惠客户,枚举：是、否',
    consultation_rate          decimal(10, 6)                        null comment '咨询费率'
)
    comment '路由利率表，保存各种利率信息和费率决策给的出参利率';

create index token_fund_code_idx
    on t_route_decision_rate_param (route_auth_token, capital_project_code);

create index token_idx
    on t_route_decision_rate_param (route_auth_token);

create table t_route_enum_code
(
    id               bigint auto_increment
        primary key,
    enum_type        varchar(32) default ''                not null,
    enum_code        varchar(32) default ''                not null,
    enum_name        varchar(32) default ''                not null,
    enum_description varchar(80) default ''                not null,
    code_type        tinyint     default 1                 not null comment '码值类型',
    enum_attribute   varchar(50) default ''                not null,
    status           tinyint     default 1                 not null,
    sort_no          smallint    default 0                 not null,
    is_delete        tinyint     default 0                 not null,
    created_time     datetime                              null,
    updated_time     datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP
)
    comment '资方编码枚举表';

create index uk_code_type
    on t_route_enum_code (enum_code, enum_type);

create table t_route_guarantor_info
(
    id                    bigint auto_increment comment '自增主键'
        primary key,
    guarantor_code        varchar(20)      null comment '担保方code',
    guarantor_name        varchar(20)      null comment '担保方名称',
    enable_flag           tinyint unsigned null comment '有效标识(0 无效 1有效)',
    guarantor_address     varchar(255)     null comment '担保方地址',
    sub_capital_config_id bigint           null comment '子资金配置id',
    created_time          datetime         null comment '创建时间',
    updated_time          datetime         null comment '更新时间'
)
    comment '担保方信息枚举表';

create table t_route_info
(
    id                  bigint auto_increment comment '自增主键'
        primary key,
    route_auth_token    varchar(255)     null comment '路由token',
    product_code        varchar(20)      not null comment '产品code',
    order_id            bigint           null comment '订单id',
    register_id         bigint           null comment '注册id',
    vcredit_cust_id     bigint           null comment '客户id',
    sub_product_code    varchar(20)      null comment '子产品code',
    capital_size        int              null comment '资金数量',
    cur_position        int default 1    null comment '当前资方位置',
    cur_inqcredit_times int              null comment '当前查征次数',
    cur_audit_times     int              null comment '预审累计用时/秒',
    route_status        varchar(20)      null comment '路由状态',
    route_failed_desc   varchar(300)     null comment '路由失败原因',
    enable_flag         tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time        datetime         null comment '创建时间',
    updated_time        datetime         null comment '更新时间',
    customer_mark       varchar(10)      null comment '客户等级',
    apply_type          tinyint          null comment '申请类型  01：新申请 02：调额 03：订单迁移 04: 预约借款订单',
    apply_amount        decimal          null comment '申请金额',
    apply_period_type   varchar(10)      null,
    reason_code         varchar(10)      null comment '路由失败原因',
    apply_period        tinyint          null comment '订单借款期次',
    pid                 varchar(20)      null comment '风控processId'
)
    comment '路由信息表，用来保存一条发起的路由信息（订单维度），包括状态，和token，与路由明细表，为一对多关系';

create index order_id
    on t_route_info (order_id);

create index register_id
    on t_route_info (register_id);

create index route_auth_token
    on t_route_info (route_auth_token);

create index vcredit_cust_id
    on t_route_info (vcredit_cust_id);

create table t_route_package_amount_limit
(
    id               bigint unsigned auto_increment comment '主键'
        primary key,
    account_id       varchar(20)    default ''                not null comment '账户id',
    amount_max_3     decimal(20, 4) default 0.0000            not null comment '3期上限金额',
    amount_max_6     decimal(20, 4) default 0.0000            not null comment '6期上限金额',
    amount_max_9     decimal(20, 4) default 0.0000            not null comment '9期上限金额',
    amount_max_12    decimal(20, 4) default 0.0000            not null comment '12期上限金额',
    rate_range       varchar(255)   default ''                not null comment '费率区间',
    day_amount_limit varchar(100)   default ''                not null comment '每日签约金额限制',
    support_product  varchar(100)   default ''                not null comment '支持产品',
    created_time     datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime       default CURRENT_TIMESTAMP not null comment '修改时间',
    period_amt       varchar(1000)                            null comment '期数金额配置'
)
    comment '资金包期数金额上限表';

create table t_route_param_exception_stat
(
    id               bigint unsigned auto_increment comment '参数编号'
        primary key,
    route_auth_token varchar(40)                         not null comment '客户路由凭证',
    exception_type   varchar(200)                        null comment '异常类型',
    exception_level  varchar(2)                          null comment '异常级别（0:初级，1:中级，2:高级）',
    exception_desc   varchar(500)                        null comment '异常描述',
    created_time     timestamp default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     timestamp default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '路由预审参数校验异常统计表';

create index route_auth_token_idx
    on t_route_param_exception_stat (route_auth_token);

create table t_route_plan
(
    id                       bigint auto_increment comment 'id'
        primary key,
    capital_project_code     varchar(30)                           null,
    priority                 int         default 0                 not null comment '优先级  数值越大 优先级越高',
    sub_capital_project_code varchar(30)                           null,
    plan_amount              decimal(16, 4)                        not null comment '计划金额',
    use_amount               decimal(16, 4)                        not null comment '使用金额',
    rollback_amount          decimal(16, 4)                        not null comment '回滚金额',
    created_time             timestamp   default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time             timestamp                             null comment '更新时间',
    desc_cn                  varchar(50) default ''                null comment '说明（中文）',
    date_plan_amount         varchar(1000)                         null,
    version_no               varchar(20)                           null comment '版本号',
    rate_range               varchar(20)                           null,
    date                     varchar(10)                           null comment '配置日期',
    period varchar (20) null comment '配置期次，以逗号分割'
)
    comment '路由资金计划表，在路由流程的末尾，发起预审请求之前，若该资方有子资金计划，需要更新此表';

create table t_route_policy_execution_details
(
    id               bigint auto_increment comment '主键'
        primary key,
    route_auth_token varchar(50)   default ''                not null comment '路由认证令牌',
    register_id      varchar(20)   default ''                not null comment '用户注册id',
    position         tinyint       default 0                 not null comment '执行顺序',
    rule_id          bigint        default 0                 not null comment '规则id',
    rule_name        varchar(50)   default ''                not null comment '规则名称',
    result           varchar(1000) default ''                not null comment '执行结果',
    policy_id        bigint                                  null comment '策略id',
    original_id      bigint                                  null comment '策略原始版本id',
    created_time     datetime      default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime      default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '路由策略执行详情表';

create index idx_register_id_created_time
    on t_route_policy_execution_details (register_id, created_time);

create index idx_token
    on t_route_policy_execution_details (route_auth_token);

create table t_route_policy_field_definition
(
    id               bigint auto_increment comment '主键'
        primary key,
    field_name       varchar(50)  default ''                not null comment '字段名称',
    field_type       varchar(10)  default ''                not null comment '字段类型',
    source_path      varchar(50)  default ''                not null comment '字段取值源',
    description      varchar(80)  default ''                not null comment '配置字段描述',
    default_value    varchar(80)  default ''                not null comment '默认值',
    compare_function varchar(50)  default ''                not null comment '校验类型',
    check_attribute  varchar(200) default ''                not null comment '校验属性',
    enable_flag      tinyint      default 1                 not null comment '是否有效',
    created_time     datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '路由策略属性表';

create table t_route_policy_info
(
    id               bigint auto_increment comment '主键'
        primary key,
    policy_name      varchar(50) default ''                not null comment '策略名称',
    priority_weight  int         default 0                 not null comment '优先级权重',
    register_tail_no varchar(50) default ''                not null comment '注册id尾号',
    valid_start_time datetime                              not null comment '生效开始时间',
    valid_end_time   datetime                              not null comment '生效结束时间',
    enable_flag      tinyint     default 1                 not null comment '是否有效',
    creat_by         varchar(50) default ''                not null comment '创建人',
    version_no       double      default 1                 not null comment '版本号',
    status           tinyint     default 1                 not null comment '草稿状态，1生效，2草稿',
    original_id      bigint      default 0                 not null comment '原始版本id',
    created_time     datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time     datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '路由策略表';

create table t_route_policy_product_rel
(
    id                bigint auto_increment comment '主键'
        primary key,
    policy_id         bigint   default 0                 not null comment '路由策略id',
    product_module_id bigint   default 0                 not null comment '产品模块id',
    enable_flag       tinyint  default 1                 not null comment '是否生效',
    created_time      datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time      datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '策略产品关联表';

create table t_route_policy_rule
(
    id           bigint auto_increment comment '主键'
        primary key,
    rule_name    varchar(50) default ''                not null comment '规则名称',
    enable_flag  tinyint     default 1                 not null comment '是否有效',
    created_time datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    status       tinyint     default 1                 not null comment '状态，1生效，2草稿',
    is_delete    tinyint     default 0                 not null comment '是否删除',
    original_id  bigint      default 0                 null comment '原始版本id'
)
    comment '路由策略规则表';

create table t_route_policy_rule_express
(
    id              bigint auto_increment comment '主键'
        primary key,
    rule_id         bigint        default 0                 not null comment '规则集id',
    rule_expression varchar(1000) default ''                not null comment '规则条件表达式',
    action          varchar(255)  default ''                not null comment '动作',
    capital_list    varchar(1000) default ''                not null comment '资方code集合',
    priority        int           default 0                 not null comment '执行顺序',
    enable_flag     tinyint       default 1                 not null comment '是否有效',
    created_time    datetime      default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time    datetime      default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '规则条件表';

create table t_route_policy_rule_rel
(
    id           bigint auto_increment comment '主键'
        primary key,
    policy_id    bigint   default 0                 not null comment '路由策略id',
    rule_id      bigint   default 0                 not null comment '规则集id',
    priority     int      default 0                 not null comment '优先级',
    enable_flag  tinyint  default 1                 not null comment '是否有效',
    created_time datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '策略规则关联表';

create table t_route_pre_check_detail_info
(
    id                   bigint unsigned auto_increment comment '主键'
        primary key,
    pre_check_info_id    bigint unsigned                         not null comment '资方路由token凭证',
    route_auth_token     varchar(50)   default ''                not null comment '资方路由token凭证',
    check_type           tinyint       default 1                 not null comment '筛选类型:1.预筛,2.复筛',
    product_code         varchar(20)   default ''                not null comment '产品类型',
    capital_project_code varchar(30)                             null,
    pre_check_rules_id   bigint        default 0                 null comment '不通过时规则ID',
    capital_config_id    bigint        default 0                 not null comment '资方配置id',
    compare_name         varchar(200)  default ''                null comment '执行规则名（比较类+字段名 如：InCompareFunction-loanPeriod）',
    filed_name           varchar(50)   default ''                null comment '规则字段名称',
    filed_desc           varchar(20)   default ''                null comment '规则字段描述',
    input_value          varchar(3000) default ''                null comment '输入值（预筛选入参字段值）',
    config_value         varchar(3000)                           null,
    compare_attribute    varchar(200)  default ''                null comment '校验属性',
    compare_result       tinyint       default 0                 not null comment '比较结果 （0：拒绝 1：通过）',
    enable_flag          tinyint       default 0                 not null comment '是否有效 1：是 0：否',
    created_time         datetime                                null comment '创建时间',
    updated_time         datetime      default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    fail_reason          varchar(200)                            null
)
    comment '资方预筛详情信息表';

create table t_route_pre_check_info
(
    id               bigint auto_increment comment '自增主键'
        primary key,
    order_id         bigint                                null comment '订单id',
    register_id      bigint                                null comment '注册id',
    vcredit_cust_id  bigint                                null comment '客户id',
    route_auth_token varchar(255)                          null comment '路由token',
    cust_mark        varchar(20) default ''                null comment '用户标签',
    status           varchar(20)                           null comment '预筛状态,1通过,0 不通过',
    enable_flag      tinyint unsigned                      null comment '是否有效',
    fail_reason      varchar(255)                          null comment '失败原因',
    created_time     datetime    default CURRENT_TIMESTAMP null comment '创建时间',
    updated_time     datetime    default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '资方预筛信息表，与资方预筛详情信息表为1对多关系';

create table t_route_pre_check_rules
(
    id                bigint auto_increment
        primary key,
    capital_config_id bigint      default 0                 not null comment '关联ID',
    field_name        varchar(50) default ''                not null comment '配置字段名称',
    field_value       varchar(3000)                         null,
    field_sort_no     int         default 0                 not null comment '字段顺序',
    valid             tinyint     default 1                 not null comment '是否启用',
    created_time      datetime                              null comment '创建时间',
    updated_time      datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uk_relation_id_field_name
        unique (capital_config_id, field_name)
)
    comment '预筛规则配置表';

create table t_route_pre_check_rules1
(
    id                bigint auto_increment
        primary key,
    capital_config_id bigint      default 0                 not null comment '关联ID',
    field_name        varchar(50) default ''                not null comment '配置字段名称',
    field_value       varchar(3000)                         null,
    field_sort_no     int         default 0                 not null comment '字段顺序',
    is_valid          tinyint     default 1                 not null comment '是否启用',
    created_time      datetime                              null comment '创建时间',
    updated_time      datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uk_relation_id_field_name
        unique (capital_config_id, field_name)
)
    comment '预筛规则配置表';

create table t_route_pre_details
(
    id                   int auto_increment
        primary key,
    route_auth_token     varchar(64) default '' not null,
    capital_project_code varchar(20) default '' not null,
    position             tinyint     default 0  not null,
    created_time         datetime               not null on update CURRENT_TIMESTAMP,
    updated_time         datetime               not null on update CURRENT_TIMESTAMP
)
    comment '预约借款路由明细表，存储资方维度的路由信息，与route_info为多对一关系';

create table t_route_product_config
(
    id                  bigint auto_increment comment '配置编号'
        primary key,
    product_code        varchar(20)       not null comment '产品编号（外键t_product_info表）',
    max_inqcredit_times tinyint           not null comment '最大查询征信次数',
    max_opertaion_times tinyint           not null comment '最大前台交互次数',
    max_audit_times     int               not null comment '最大预审批时间',
    max_sign_nucc_times int               not null comment '最大网联签署次数',
    enable_flag         tinyint           not null comment '有效标识(0 无效 1有效)',
    created_time        datetime          not null comment '创建时间',
    updated_time        datetime          not null comment '更新时间',
    min_fundcode_times  int     default 0 not null comment '支持最小资方数量(包含)',
    max_fund_count      tinyint default 0 not null,
    max_rate_fund_count varchar(500)      null comment '年化费率所能路由资方最大个数'
)
    comment '路由产品属性配置表';

create table t_route_product_enum
(
    id            bigint auto_increment comment '主键'
        primary key,
    prod_code     char(10)               not null comment '产品编码',
    prod_name     varchar(20)            not null comment '产品名称',
    enable_flag   tinyint                not null comment '是否有效',
    desc_cn       varchar(50) default '' not null comment '说明（中文）',
    created_time  datetime               null comment '创建时间',
    updated_time  datetime               null comment '更新时间',
    sub_prod_code varchar(20)            not null comment '子产品编码',
    sub_prod_name varchar(20)            not null
)
    comment '路由产品枚举表';

create table t_route_product_module
(
    id           bigint auto_increment comment '主键'
        primary key,
    module_name  varchar(40)  default ''                not null comment '模块名称',
    product_code varchar(20)  default ''                not null comment '产品编码',
    period varchar (20) default '' not null comment '支持期数',
    min_loan_amt int          default 0                 not null comment '最小借款金额',
    max_loan_amt int          default 0                 not null comment '最大借款金额',
    rate_ranges  varchar(255) default ''                not null comment '费率区间',
    enable_flag  tinyint      default 1                 not null comment '是否生效',
    created_time datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment '产品模块表';

create table t_route_rule_field_definition
(
    id                bigint auto_increment comment '主键'
        primary key,
    field_name        varchar(50)  default ''                not null comment '配置字段名称',
    field_type        varchar(10)  default ''                not null comment '字段的类型',
    field_sort_no     int          default 0                 not null comment '字段顺序',
    source_path       varchar(50)  default ''                not null comment '字段取值源',
    description       varchar(80)  default ''                not null comment '配置字段描述',
    compare_type      varchar(20)  default '0'               not null comment '比较类型',
    compare_attribute varchar(200) default ''                not null comment '比较属性',
    check_type        tinyint      default 0                 not null comment '校验类型',
    check_attribute   varchar(200) default ''                not null comment '校验属性',
    required          tinyint      default 1                 not null comment '是否必需',
    valid             tinyint      default 1                 not null comment '是否有效',
    created_time      datetime                               null comment '创建时间',
    updated_time      datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint uk_field_name_is_valid
        unique (field_name, valid)
)
    comment '路由规则枚举表';

create table t_route_sign_limit_amt
(
    id                   bigint auto_increment comment '主键'
        primary key,
    capital_project_code varchar(30)                              null,
    product_code         varchar(20)    default ''                not null comment '产品编码',
    sub_product_code     varchar(20)    default ''                not null comment '子产品编码',
    effective_date       varchar(10)    default ''                not null comment '生效日期 yyyyMMdd',
    rate_ranges          varchar(255)   default ''                not null comment '费率区间列表',
    limit_amount         decimal(16, 4) default 0.0000            not null comment '头寸金额，单位元',
    amt_type             tinyint        default 1                 not null comment '头寸类型，1总头寸，2兜底头寸',
    active               tinyint        default 1                 not null comment '有效标识，1生效，0失效',
    created_time         datetime       default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time         datetime       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    surplus_limit_amount decimal(20, 4) default 0.0000            null comment '当月头寸富余(月初至生效日前一天累计未利用的资金额)，单位元',
    excess_limit_amount  decimal(20, 4) default 0.0000            null comment '超额投放金额限额，单位元',
    surplus_amount       decimal(20, 4) default 0.0000            null comment '当日头寸富余使用金额',
    excess_amount        decimal(20, 4) default 0.0000            null comment '当日头寸超额使用金额',
    used_amount          decimal(20, 4) default 0.0000            null comment '头寸使用额度'
)
    comment '资方头寸配置表';

create index idx_fund_sub_prod_date
    on t_route_sign_limit_amt (capital_project_code, sub_product_code, effective_date);

create index idx_prod_date
    on t_route_sign_limit_amt (product_code, effective_date);

create table t_route_sign_limit_upload_file
(
    id           bigint auto_increment comment 'id'
        primary key,
    file_name    varchar(50)                        not null comment '文件名',
    ecm_id       varchar(50)                        not null comment '文件存放在ecm的id',
    created_time datetime default CURRENT_TIMESTAMP not null comment '创建日期',
    updated_time datetime                           null comment '更新日期',
    upload_by    varchar(100)                       null comment '上传人',
    constraint t_route_sign_limit_upload_file_UN
        unique (ecm_id)
)
    comment '头寸限额上传文件记录表';

create table t_route_sub_capital_config
(
    id                        bigint auto_increment comment '自增主键'
        primary key,
    sub_capital_project_code  varchar(30)      null,
    sub_capital_project_name  varchar(30)      null,
    capital_project_config_id varchar(30)      null,
    guarantor_id              bigint           null comment '担保方信息id',
    sign_code                 varchar(20)      null comment '签约主体编码',
    year_rate                 varchar(255)     null comment '资方年化利率',
    enable_flag               tinyint unsigned null comment '有效标识(0 无效 1有效)',
    created_time              datetime         null comment '创建时间',
    updated_time              datetime         null comment '更新时间'
)
    comment '资金模式表，与资产表为多对一关系，一个资产可能有多个资金模式';

create table t_vcs_push
(
    id            bigint unsigned auto_increment comment '主键'
        primary key,
    total         bigint                                not null comment '订单总数',
    success_total bigint      default 0                 not null comment '订单推送成功数量',
    push_type     int         default 0                 not null comment '推送数据类型;0、未设置;1、batchDivision VCS分批分案数据;2、fullOverdueData 全量逾期数据;3、fullPreReminderData 全量预提醒数据;',
    push_result   int         default 0                 not null comment '推送结果;0、未设置;1、成功；2、失败；',
    remark        varchar(80) default ''                not null comment '备注',
    batch_time    datetime    default CURRENT_TIMESTAMP not null comment '批次时间',
    end_time      datetime    default CURRENT_TIMESTAMP not null comment '结束时间',
    created_time  datetime    default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_time  datetime    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间'
)
    comment 'VCS数据推送记录表';

create index idx_created_time
    on t_vcs_push (created_time);

create
    definer = p_vooc_rw@`%` function CountOrderBenefits() returns int
BEGIN
  DECLARE end_of_day DATETIME;
  DECLARE start_of_month DATE;
  DECLARE start_date DATE;
  DECLARE cnt INT;

  SET end_of_day = TIMESTAMPADD(SECOND, -1, DATE_ADD(CURDATE(), INTERVAL 1 DAY));
  SET start_of_month = DATE_FORMAT(CURDATE(), '%Y-%m-01');
  SET start_date = DATE_SUB(CURDATE(), INTERVAL 2 DAY);

  SELECT count(1) INTO cnt
    FROM `t_order_benefits` a
    LEFT JOIN `t_payment_record` b ON a.`order_id` = b.`order_id`
  WHERE a.`benefits_subject`= 'vip_ddq_pay_later'
    AND a.`created_time` < start_of_month
    AND a.`updated_time` >= start_date
    AND a.`updated_time` < end_of_day;

  RETURN cnt;
END;

